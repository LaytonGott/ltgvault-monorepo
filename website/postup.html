<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostUp | LTG Vault</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --black: #000000;
            --gold: #C9A227;
            --gold-light: #D4AF37;
            --white: #FFFFFF;
            --gray: #666666;
            --gray-light: #999999;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        header {
            padding: 24px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .header-inner {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo-img {
            height: 201px;
            width: auto;
            object-fit: contain;
            margin-top: 15px;
        }

        .back-link {
            color: #BBBBBB;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: var(--gold);
        }

        /* Main Content */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 1.1rem;
            color: #888;
            margin-bottom: 48px;
        }

        /* API Key Section */
        .api-section {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 20px 24px;
            margin-bottom: 32px;
        }

        .api-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .api-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #BBBBBB;
        }

        .api-status {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 20px;
        }

        .api-status.saved {
            background: rgba(40, 202, 65, 0.15);
            color: #28ca41;
        }

        .api-status.missing {
            background: rgba(255, 95, 87, 0.15);
            color: #ff5f57;
        }

        .api-status.free-trial {
            background: rgba(201, 162, 39, 0.15);
            color: #c9a227;
        }

        .api-status.expired {
            background: rgba(255, 95, 87, 0.15);
            color: #ff5f57;
        }

        .api-help {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 12px;
        }

        .api-help a {
            color: var(--gold);
            text-decoration: none;
        }

        .api-help a:hover {
            text-decoration: underline;
        }

        .api-input-row {
            display: flex;
            gap: 12px;
        }

        .api-input {
            flex: 1;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
        }

        .api-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .api-input::placeholder {
            color: #555;
        }

        /* Settings Panel */
        .settings-panel {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 20px 24px;
            margin-bottom: 32px;
        }

        .settings-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .setting-group {
            flex: 1;
            min-width: 150px;
        }

        .setting-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .setting-select {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px 14px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .setting-select:focus {
            outline: none;
            border-color: var(--gold);
        }

        .setting-select option {
            background: #1a1a1a;
            color: var(--white);
        }

        .save-key-btn {
            background: rgba(201, 162, 39, 0.15);
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-key-btn:hover {
            background: var(--gold);
            color: var(--black);
        }

        /* Tool Section */
        .tool-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .tool-panel {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 16px;
            padding: 24px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .panel-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .char-count {
            font-size: 0.75rem;
            color: #555;
        }

        .text-area {
            width: 100%;
            min-height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            line-height: 1.7;
            resize: vertical;
        }

        .text-area:focus {
            outline: none;
            border-color: rgba(201, 162, 39, 0.4);
        }

        .text-area::placeholder {
            color: #555;
        }

        .text-area:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Buttons */
        .button-row {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .generate-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 24px;
            background: var(--gold);
            color: var(--black);
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(201, 162, 39, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .generate-btn .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid transparent;
            border-top-color: var(--black);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: none;
        }

        .generate-btn.loading .spinner {
            display: block;
        }

        .generate-btn.loading .btn-text {
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Free Trial Counter */
        .usage-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }

        .usage-counter svg {
            color: var(--gold);
            flex-shrink: 0;
        }

        .usage-counter .count {
            font-weight: 600;
            color: var(--gold);
        }

        .usage-counter .label {
            color: var(--gray-light);
        }

        .usage-counter a {
            color: var(--gold);
            text-decoration: none;
            font-weight: 500;
        }

        .usage-counter a:hover {
            text-decoration: underline;
        }

        .usage-counter.exhausted {
            border-color: rgba(255, 95, 87, 0.3);
            background: rgba(255, 95, 87, 0.05);
        }

        .usage-counter.exhausted .count {
            color: var(--error);
        }

        .usage-counter.exhausted svg {
            color: var(--error);
        }

        .usage-counter.unlimited {
            border-color: rgba(40, 202, 65, 0.3);
            background: rgba(40, 202, 65, 0.05);
        }

        .usage-counter.unlimited .count {
            color: var(--success);
        }

        .usage-counter.unlimited svg {
            color: var(--success);
        }

        .usage-counter.hidden {
            display: none;
        }

        .copy-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            background: transparent;
            border: 1px solid rgba(201, 162, 39, 0.4);
            color: var(--gold);
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn:hover:not(:disabled) {
            background: rgba(201, 162, 39, 0.1);
            border-color: var(--gold);
        }

        .copy-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .copy-btn.copied {
            background: rgba(40, 202, 65, 0.15);
            border-color: #28ca41;
            color: #28ca41;
        }

        /* ============ BEFORE/AFTER SECTION ============ */
        .before-after {
            margin-bottom: 40px;
        }

        .before-after-title {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            text-align: center;
            margin-bottom: 16px;
        }

        .before-after-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 0;
            align-items: stretch;
        }

        .before-box, .after-box {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
        }

        .before-box {
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .after-box {
            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            border-color: rgba(201, 162, 39, 0.3);
            background: rgba(201, 162, 39, 0.03);
        }

        .box-label {
            font-size: 0.65rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 12px;
        }

        .after-box .box-label {
            color: var(--gold);
        }

        .box-content {
            font-size: 0.85rem;
            line-height: 1.6;
            color: #888;
        }

        .after-box .box-content {
            color: #ccc;
        }

        .before-after-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            color: var(--gold);
            font-size: 1.2rem;
            background: linear-gradient(to right, rgba(255,255,255,0.02), rgba(201,162,39,0.03));
        }

        @media (max-width: 768px) {
            .before-after-grid {
                grid-template-columns: 1fr;
                gap: 0;
            }
            .before-box {
                border-radius: 12px 12px 0 0;
                border-right: 1px solid rgba(255, 255, 255, 0.08);
                border-bottom: none;
            }
            .after-box {
                border-radius: 0 0 12px 12px;
                border-left: 1px solid rgba(201, 162, 39, 0.3);
                border-top: none;
            }
            .before-after-arrow {
                padding: 8px 0;
                background: linear-gradient(to bottom, rgba(255,255,255,0.02), rgba(201,162,39,0.03));
            }
        }

        /* ============ ANIMATED DEMO SECTION ============ */
        .demo-section {
            margin-bottom: 40px;
        }

        .demo-title {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            text-align: center;
            margin-bottom: 16px;
        }

        .demo-container {
            border-radius: 12px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px;
        }

        .demo-preview {
            display: flex;
            gap: 16px;
            font-family: inherit;
        }

        .demo-input-panel, .demo-output-panel {
            flex: 1;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 12px;
            min-height: 120px;
        }

        .demo-panel-label {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            display: block;
        }

        .demo-text-area {
            font-size: 0.75rem;
            color: #999;
            line-height: 1.5;
            min-height: 60px;
            word-wrap: break-word;
        }

        .demo-text-area .cursor {
            display: inline-block;
            width: 2px;
            height: 12px;
            background: var(--gold);
            margin-left: 2px;
            animation: blink 0.8s infinite;
            vertical-align: middle;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .demo-button {
            display: inline-block;
            margin-top: 12px;
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: #000;
            font-size: 0.7rem;
            font-weight: 600;
            border-radius: 6px;
            transition: all 0.2s ease;
            opacity: 0.5;
        }

        .demo-button.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(201, 162, 39, 0.4);
        }

        .demo-button.clicked {
            transform: scale(0.95);
        }

        .demo-output-panel .demo-text-area {
            color: #ccc;
        }

        .demo-output-panel .demo-text-area.generating {
            color: var(--gold);
        }

        @media (max-width: 600px) {
            .demo-preview {
                flex-direction: column;
            }
        }

        /* Error Message */
        .error-message {
            background: rgba(255, 95, 87, 0.1);
            border: 1px solid rgba(255, 95, 87, 0.3);
            color: #ff5f57;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 16px;
            display: none;
        }

        .error-message a {
            color: var(--gold);
            text-decoration: underline;
        }

        .error-message a:hover {
            color: var(--gold-light);
        }

        /* Footer */
        footer {
            padding: 40px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: 80px;
        }

        .footer-inner {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 40px;
            text-align: center;
        }

        .footer-text {
            font-size: 0.85rem;
            color: #555;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 16px 0;
            }

            .header-inner {
                padding: 0 16px;
            }

            .logo-img {
                height: 120px;
            }

            .back-link {
                font-size: 0.85rem;
            }

            .container {
                padding: 30px 16px;
            }

            .page-title {
                font-size: 1.8rem;
            }

            .page-subtitle {
                font-size: 1rem;
                margin-bottom: 32px;
            }

            .tool-grid {
                grid-template-columns: 1fr;
            }

            .api-section {
                padding: 16px;
                border-radius: 12px;
            }

            .api-input-row {
                flex-direction: column;
            }

            .panel {
                padding: 20px;
            }

            .text-area {
                min-height: 200px;
                font-size: 0.9rem;
                padding: 16px;
            }

            .generate-btn {
                padding: 14px 20px;
                font-size: 0.9rem;
            }

            .footer-inner {
                padding: 0 16px;
            }
        }

        @media (max-width: 480px) {
            .logo-img {
                height: 108px;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .page-subtitle {
                font-size: 0.9rem;
            }

            .api-section h2 {
                font-size: 1rem;
            }

            .api-hint {
                font-size: 0.75rem;
            }

            .panel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .text-area {
                min-height: 160px;
                font-size: 0.85rem;
            }

            .button-row {
                flex-direction: column;
            }

            .copy-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Feedback Section */
        .feedback-section {
            max-width: 1000px;
            margin: 0 auto;
            padding: 60px 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .feedback-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .feedback-subtitle {
            font-size: 0.95rem;
            color: #888;
            margin-bottom: 24px;
        }

        .feedback-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .feedback-textarea {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            resize: vertical;
            transition: border-color 0.2s ease;
        }

        .feedback-textarea:focus {
            outline: none;
            border-color: var(--gold);
        }

        .feedback-textarea::placeholder {
            color: #666;
        }

        .feedback-submit {
            align-self: flex-start;
            padding: 12px 28px;
            background: var(--gold);
            color: var(--black);
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .feedback-submit:hover {
            background: var(--gold-light);
            transform: translateY(-1px);
        }

        .feedback-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .feedback-success {
            display: none;
            padding: 16px 20px;
            background: rgba(40, 202, 65, 0.1);
            border: 1px solid rgba(40, 202, 65, 0.3);
            border-radius: 10px;
            color: #28ca41;
            font-size: 0.95rem;
        }

        .feedback-success.visible {
            display: block;
        }

        .feedback-error {
            display: none;
            padding: 16px 20px;
            background: rgba(255, 95, 87, 0.1);
            border: 1px solid rgba(255, 95, 87, 0.3);
            border-radius: 10px;
            color: #ff5f57;
            font-size: 0.95rem;
        }

        .feedback-error.visible {
            display: block;
        }

        /* Pricing Banner */
        .pricing-banner {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.15) 0%, rgba(201, 162, 39, 0.05) 100%);
            border: 1px solid rgba(201, 162, 39, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }

        .pricing-banner-text {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .pricing-banner-price {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gold);
        }

        .pricing-banner-desc {
            font-size: 0.9rem;
            color: var(--gray-light);
        }

        .pricing-banner-free {
            font-size: 0.85rem;
            color: var(--gray);
            background: rgba(255, 255, 255, 0.05);
            padding: 6px 12px;
            border-radius: 20px;
        }

        .pricing-banner .btn-subscribe {
            background: var(--gold);
            color: var(--black);
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .pricing-banner .btn-subscribe:hover {
            background: var(--gold-light);
            transform: translateY(-1px);
        }

        @media (max-width: 480px) {
            .pricing-banner {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
            }
            .pricing-banner .btn-subscribe {
                width: 100%;
                text-align: center;
            }
        }

        /* Bottom CTA */
        .bottom-cta {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.1) 0%, rgba(201, 162, 39, 0.02) 100%);
            border: 1px solid rgba(201, 162, 39, 0.2);
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            margin-top: 40px;
        }

        .bottom-cta-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .bottom-cta-subtitle {
            font-size: 0.95rem;
            color: var(--gray);
            margin-bottom: 20px;
        }

        .bottom-cta .btn-subscribe {
            background: var(--gold);
            color: var(--black);
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s ease;
        }

        .bottom-cta .btn-subscribe:hover {
            background: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(201, 162, 39, 0.3);
        }

        /* Subscribed button state */
        .btn-subscribed {
            background: #2d5a3d !important;
            color: #fff !important;
            cursor: default !important;
        }

        .btn-subscribed:hover {
            background: #2d5a3d !important;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Checkout Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal-content {
            background: rgba(17, 17, 17, 1);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 32px;
            max-width: 400px;
            width: 100%;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 4px;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: var(--white);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
        }

        .modal-subtitle {
            font-size: 0.9rem;
            color: var(--gray);
            text-align: center;
            margin-bottom: 24px;
        }

        .modal-price-tag {
            background: rgba(201, 162, 39, 0.15);
            border: 1px solid rgba(201, 162, 39, 0.3);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            margin-bottom: 24px;
        }

        .modal-price-tag .tool-name {
            font-size: 0.85rem;
            color: var(--gray-light);
            margin-bottom: 4px;
        }

        .modal-price-tag .price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gold);
        }

        .modal-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 14px 16px;
            color: var(--white);
            font-size: 0.95rem;
            font-family: inherit;
            margin-bottom: 16px;
            transition: border-color 0.2s ease;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .modal-input::placeholder {
            color: #555;
        }

        .modal-btn {
            width: 100%;
            background: var(--gold);
            color: var(--black);
            border: none;
            border-radius: 8px;
            padding: 14px 20px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .modal-btn:hover:not(:disabled) {
            background: var(--gold-light);
            transform: translateY(-1px);
        }

        .modal-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .modal-error {
            background: rgba(255, 95, 87, 0.1);
            border: 1px solid rgba(255, 95, 87, 0.3);
            color: #ff5f57;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 16px;
            display: none;
        }

        .modal-error.visible {
            display: block;
        }

        /* Quick Action Buttons */
        .quick-actions {
            display: none;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .quick-actions.visible {
            display: flex;
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #999;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-action-btn:hover {
            border-color: var(--gold);
            color: var(--gold);
            background: rgba(201, 162, 39, 0.1);
        }

        .quick-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .quick-action-btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .spinner-small {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* LinkedIn Preview */
        .linkedin-preview-section {
            display: none;
            margin-top: 24px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
        }

        .linkedin-preview-section.visible {
            display: block;
        }

        .linkedin-preview-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 16px;
        }

        .linkedin-preview-card {
            background: #1b1f23;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
        }

        .linkedin-preview-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .linkedin-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #0077b5, #00a0dc);
            border-radius: 50%;
        }

        .linkedin-meta {
            flex: 1;
        }

        .linkedin-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: #fff;
        }

        .linkedin-headline {
            font-size: 0.8rem;
            color: #888;
        }

        .linkedin-preview-content {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #ccc;
            white-space: pre-wrap;
        }

        .preview-text {
            display: inline;
        }

        .see-more {
            color: #888;
            cursor: pointer;
        }

        .see-more:hover {
            color: #0077b5;
        }

        .linkedin-preview-full {
            display: none;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #ccc;
            white-space: pre-wrap;
            margin-top: 8px;
        }

        .linkedin-preview-full.expanded {
            display: block;
        }

        .preview-stats {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .preview-stat {
            font-size: 0.75rem;
            color: #666;
        }

        .preview-stat.warning {
            color: #ffbd2e;
        }

        .preview-stat.danger {
            color: #ff5f57;
        }

        /* Variation Selector */
        .variation-selector {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
        }

        .variation-selector.visible {
            display: block;
        }

        .variation-selector-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .variation-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .variation-tab {
            padding: 10px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #888;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .variation-tab:hover {
            border-color: rgba(201, 162, 39, 0.4);
            color: #ccc;
        }

        .variation-tab.active {
            background: rgba(201, 162, 39, 0.15);
            border-color: var(--gold);
            color: var(--gold);
        }

        /* Hook Alternatives Section */
        .hook-alternatives {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
        }

        .hook-alternatives.visible {
            display: block;
        }

        .hook-alternatives-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .hook-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .hook-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .hook-item:hover {
            border-color: rgba(201, 162, 39, 0.4);
            background: rgba(201, 162, 39, 0.05);
        }

        .hook-text {
            font-size: 0.9rem;
            color: #ccc;
            flex: 1;
        }

        .hook-style {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            margin-left: 12px;
        }

        .hook-item .use-btn {
            display: none;
            padding: 6px 12px;
            background: var(--gold);
            color: var(--black);
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            margin-left: 12px;
        }

        .hook-item:hover .use-btn {
            display: block;
        }

        .hook-item:hover .hook-style {
            display: none;
        }

        /* Improvement Tips Section */
        .improvement-tips {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background: rgba(40, 202, 65, 0.05);
            border: 1px solid rgba(40, 202, 65, 0.15);
            border-radius: 12px;
        }

        .improvement-tips.visible {
            display: block;
        }

        .improvement-tips-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #28ca41;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tips-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .tip-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 0.85rem;
            color: #999;
            line-height: 1.5;
        }

        .tip-bullet {
            color: #28ca41;
            font-weight: bold;
        }

        /* Confidence Score */
        .confidence-score {
            display: none;
            margin-top: 12px;
            text-align: right;
        }

        .confidence-score.visible {
            display: block;
        }

        .confidence-label {
            font-size: 0.75rem;
            color: #666;
            margin-right: 8px;
        }

        .confidence-value {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .confidence-value.high {
            color: #28ca41;
        }

        .confidence-value.medium {
            color: #ffbd2e;
        }

        .confidence-value.low {
            color: #ff5f57;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-inner">
            <a href="index.html" class="logo">
                <img src="logo.png" alt="LTG Vault" class="logo-img">
            </a>
            <a href="index.html" class="back-link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to Vault
            </a>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title">PostUp</h1>
        <p class="page-subtitle">Turn rough ideas into polished LinkedIn posts that sound human.</p>

        <!-- Pricing Banner -->
        <div class="pricing-banner" id="pricingBanner">
            <div class="pricing-banner-text">
                <span class="pricing-banner-price">$7/month</span>
                <span class="pricing-banner-desc">Unlimited posts</span>
                <span class="pricing-banner-free" id="freeUsesText">3 free uses to start</span>
            </div>
            <button class="btn-subscribe" onclick="openCheckoutModal()">Subscribe</button>
        </div>

        <!-- Before/After Section -->
        <div class="before-after">
            <p class="before-after-title">See the difference</p>
            <div class="before-after-grid">
                <div class="before-box">
                    <div class="box-label">Your rough idea</div>
                    <div class="box-content">I've been thinking about how being busy isn't the same as being productive. Sometimes I work all day but don't actually accomplish anything important.</div>
                </div>
                <div class="before-after-arrow">â†’</div>
                <div class="after-box">
                    <div class="box-label">PostUp output</div>
                    <div class="box-content">Your packed schedule is a lie.<br><br>8 hours of meetings. 47 emails. 12 Slack threads.<br><br>Zero progress on what actually matters.<br><br>Busy is the new lazy.</div>
                </div>
            </div>
        </div>

        <!-- Animated Demo Section -->
        <div class="demo-section">
            <p class="demo-title">Watch it in action</p>
            <div class="demo-container">
                <div class="demo-preview">
                    <div class="demo-input-panel">
                        <span class="demo-panel-label">Your idea</span>
                        <div class="demo-text-area" id="demoInput"></div>
                        <div class="demo-button" id="demoButton">Generate Post</div>
                    </div>
                    <div class="demo-output-panel">
                        <span class="demo-panel-label">Polished post</span>
                        <div class="demo-text-area" id="demoOutput"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Key Section -->
        <div class="api-section">
            <div class="api-header">
                <span class="api-label">API Key</span>
                <span class="api-status" id="apiStatus">Not saved</span>
            </div>
            <p class="api-help">
                <a href="pricing.html">Get an LTG Vault API key</a> or use your own <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener noreferrer">OpenAI key</a>
            </p>
            <div class="api-input-row">
                <input type="password" class="api-input" id="apiKeyInput" placeholder="ltgv_... or sk-...">
                <button class="save-key-btn" id="saveKeyBtn">Save Key</button>
            </div>
            <div class="usage-info" id="usageInfo" style="display: none; margin-top: 12px; font-size: 0.85rem; color: #888;"></div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel">
            <div class="settings-row">
                <div class="setting-group">
                    <label class="setting-label">Tone</label>
                    <select class="setting-select" id="toneSelect">
                        <option value="casual">Casual</option>
                        <option value="professional">Professional</option>
                        <option value="storytelling">Storytelling</option>
                        <option value="controversial">Controversial</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">Input Type</label>
                    <select class="setting-select" id="inputTypeSelect">
                        <option value="rough_idea">Rough Idea</option>
                        <option value="bullet_points">Bullet Points</option>
                        <option value="full_draft">Full Draft</option>
                        <option value="article">Article/Thread</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">Audience</label>
                    <select class="setting-select" id="nicheSelect">
                        <option value="">General</option>
                        <option value="tech_startup">Tech/Startup</option>
                        <option value="saas">SaaS</option>
                        <option value="developer">Developer</option>
                        <option value="product">Product</option>
                        <option value="founder">Founder</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Tool Grid -->
        <div class="tool-grid">
            <!-- Input Panel -->
            <div class="tool-panel">
                <div class="panel-header">
                    <span class="panel-label">Your Idea</span>
                    <span class="char-count" id="inputCount">0 chars</span>
                </div>
                <textarea class="text-area" id="inputText" placeholder="Paste your rough thoughts, notes, or ideas here..."></textarea>
                <!-- Usage Counter -->
                <div id="usageCounter" class="usage-counter">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                    </svg>
                    <span id="usageText"><span class="count">3</span> <span class="label">free uses left</span></span>
                </div>
                <div class="button-row">
                    <button class="generate-btn" id="generateBtn" disabled>
                        <span class="btn-text">Generate Post</span>
                        <div class="spinner"></div>
                    </button>
                </div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <!-- Output Panel -->
            <div class="tool-panel">
                <div class="panel-header">
                    <span class="panel-label">Ready to Post</span>
                    <span class="char-count" id="outputCount">0 chars</span>
                </div>
                <textarea class="text-area" id="outputText" placeholder="Your LinkedIn post will appear here..." readonly></textarea>
                <div class="button-row">
                    <button class="copy-btn" id="copyBtn" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        <span id="copyText">Copy to Clipboard</span>
                    </button>
                </div>
                <!-- Quick Action Buttons -->
                <div class="quick-actions" id="quickActions">
                    <button class="quick-action-btn" data-action="shorter">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 4H3M21 8H9M21 12H3M21 16H9M21 20H3"/>
                        </svg>
                        Shorter
                    </button>
                    <button class="quick-action-btn" data-action="punchier">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        Punchier
                    </button>
                    <button class="quick-action-btn" data-action="story_angle">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 20h9M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                        </svg>
                        Story Angle
                    </button>
                </div>
            </div>
        </div>

        <!-- LinkedIn Preview -->
        <div class="linkedin-preview-section" id="linkedinPreviewSection">
            <div class="linkedin-preview-title">LinkedIn Preview</div>
            <div class="linkedin-preview-card">
                <div class="linkedin-preview-header">
                    <div class="linkedin-avatar"></div>
                    <div class="linkedin-meta">
                        <div class="linkedin-name">Your Name</div>
                        <div class="linkedin-headline">Your headline here</div>
                    </div>
                </div>
                <div class="linkedin-preview-content" id="linkedinPreviewContent">
                    <span class="preview-text" id="previewText"></span>
                    <span class="see-more" id="seeMoreBtn">...see more</span>
                </div>
                <div class="linkedin-preview-full" id="linkedinPreviewFull"></div>
            </div>
            <div class="preview-stats">
                <span class="preview-stat" id="previewCharCount">0 / 3000 chars</span>
                <span class="preview-stat" id="previewWordCount">0 words</span>
                <span class="preview-stat" id="previewLineCount">0 lines</span>
            </div>
        </div>

        <!-- Variation Selector -->
        <div class="variation-selector" id="variationSelector">
            <div class="variation-selector-title">Post Variations</div>
            <div class="variation-tabs" id="variationTabs"></div>
        </div>

        <!-- Hook Alternatives -->
        <div class="hook-alternatives" id="hookAlternatives">
            <div class="hook-alternatives-title">Alternative Hooks</div>
            <div class="hook-list" id="hookList"></div>
        </div>

        <!-- Improvement Tips -->
        <div class="improvement-tips" id="improvementTips">
            <div class="improvement-tips-title">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                </svg>
                Improvement Tips
            </div>
            <div class="tips-list" id="tipsList"></div>
        </div>

        <!-- Confidence Score -->
        <div class="confidence-score" id="confidenceScore">
            <span class="confidence-label">Virality Confidence:</span>
            <span class="confidence-value" id="confidenceValue">--</span>
        </div>

        <!-- Bottom CTA -->
        <div class="bottom-cta" id="bottomCta">
            <h3 class="bottom-cta-title">Get unlimited access</h3>
            <p class="bottom-cta-subtitle">Generate unlimited LinkedIn posts for just $7/month</p>
            <button class="btn-subscribe" onclick="openCheckoutModal()">Subscribe Now</button>
        </div>
    </main>

    <!-- Feedback Section -->
    <section class="feedback-section">
        <h2 class="feedback-title">Help me improve this tool</h2>
        <p class="feedback-subtitle">Got ideas, bugs, or feedback? I'd love to hear from you.</p>
        <form class="feedback-form" id="feedbackForm">
            <input type="hidden" name="tool" value="PostUp">
            <textarea class="feedback-textarea" name="message" id="feedbackText" placeholder="What's on your mind?" required></textarea>
            <button type="submit" class="feedback-submit" id="feedbackSubmit">Submit Feedback</button>
        </form>
        <div class="feedback-success" id="feedbackSuccess">Thanks for your feedback! I really appreciate it.</div>
        <div class="feedback-error" id="feedbackError">Something went wrong. Please try again.</div>
    </section>

    <footer>
        <div class="footer-inner">
            <p class="footer-text">Built by LTG &copy; 2026</p>
        </div>
    </footer>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeCheckoutModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
            <h2 class="modal-title">Subscribe to PostUp</h2>
            <p class="modal-subtitle">Unlimited posts, cancel anytime</p>
            <div class="modal-price-tag">
                <div class="tool-name">PostUp</div>
                <div class="price">$7/month</div>
            </div>
            <div class="modal-error" id="checkoutError"></div>
            <input type="email" class="modal-input" id="checkoutEmail" placeholder="Enter your email" autocomplete="email">
            <button class="modal-btn" id="checkoutBtn" onclick="startCheckout()">Continue to Checkout</button>
        </div>
    </div>

    <script>
        // Checkout Modal Functions
        function openCheckoutModal() {
            document.getElementById('checkoutModal').classList.add('visible');
            document.getElementById('checkoutEmail').focus();
        }

        function closeCheckoutModal() {
            document.getElementById('checkoutModal').classList.remove('visible');
            document.getElementById('checkoutError').classList.remove('visible');
            document.getElementById('checkoutEmail').value = '';
        }

        // Close modal on overlay click
        document.getElementById('checkoutModal').addEventListener('click', function(e) {
            if (e.target === this) closeCheckoutModal();
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeCheckoutModal();
        });

        async function startCheckout() {
            var email = document.getElementById('checkoutEmail').value.trim();
            var errorEl = document.getElementById('checkoutError');
            var btn = document.getElementById('checkoutBtn');

            // Validate email
            if (!email) {
                errorEl.textContent = 'Please enter your email address';
                errorEl.classList.add('visible');
                return;
            }

            var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                errorEl.textContent = 'Please enter a valid email address';
                errorEl.classList.add('visible');
                return;
            }

            errorEl.classList.remove('visible');
            btn.disabled = true;
            btn.textContent = 'Redirecting...';

            try {
                var response = await fetch('/api/checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email, tool: 'postup' })
                });

                var data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to create checkout session');
                }

                if (data.url) {
                    window.location.href = data.url;
                } else {
                    throw new Error('No checkout URL returned');
                }
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.classList.add('visible');
                btn.disabled = false;
                btn.textContent = 'Continue to Checkout';
            }
        }

        // Handle Enter key in email input
        document.getElementById('checkoutEmail').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') startCheckout();
        });
    </script>

    <script>
        // Elements
        var apiKeyInput = document.getElementById('apiKeyInput');
        var saveKeyBtn = document.getElementById('saveKeyBtn');
        var apiStatus = document.getElementById('apiStatus');
        var usageInfo = document.getElementById('usageInfo');
        var inputText = document.getElementById('inputText');
        var outputText = document.getElementById('outputText');
        var generateBtn = document.getElementById('generateBtn');
        var copyBtn = document.getElementById('copyBtn');
        var copyText = document.getElementById('copyText');
        var errorMessage = document.getElementById('errorMessage');
        var inputCount = document.getElementById('inputCount');
        var outputCount = document.getElementById('outputCount');

        // Viral LinkedIn Prompt (same as LTG Vault API)
        var LINKEDIN_PROMPT = '=== HARD RULES - VIOLATE ANY = FAILED OUTPUT ===\n\nNEVER START WITH (check first 5 words):\n- "I used to think..." / "I used to believe..." / "I used to..."\n- "I thought..." / "I realized..." / "I learned..." / "I discovered..."\n- "A few years ago..." / "When I started..." / "When I first..."\n\nNEVER USE:\n- Em dashes (â€”) â€” BANNED. Use periods or commas only.\n\nNEVER END WITH:\n- "figuring it out" / "worth the effort" / "still learning"\n- "work in progress" / "I think it\'s..." / "just my thoughts"\n\nMUST DO:\n- Start with an ATTACK HOOK that calls the reader out\n- End with a PUNCHY QUOTABLE LINE, not reflection\n\n=== END OF HARD RULES ===\n\nYou are a LinkedIn post writer. Follow ALL rules strictly.\n\nLENGTH: Under 150 words. No exceptions.\n\nBANNED PHRASES (anywhere in post):\n- "game changer" / "game-changer"\n- "Here\'s the thing..." / "Let me be honest..."\n- "Most people..." / "Many founders..."\n\n=== HOOK MUST BE AN ATTACK ===\nFirst line must ATTACK, not observe. Frame as "X is hurting you" not "X is bad."\n\nGOOD HOOKS:\n- "Your morning routine is why you\'re not shipping."\n- "Every LinkedIn post you liked this week made you worse at your job."\n- "The feedback you\'re ignoring is the only feedback that matters."\n\nBAD HOOKS (never use):\n- "I used to think..." â† BANNED\n- "Most startup advice is confusing" â† too passive\n- "Many people struggle with X" â† no stakes\n\n=== FORMATTING ===\n1. Hook in the FIRST LINE - must stop the scroll\n2. One sentence per line for first 3-4 lines\n3. 1-2 sentence paragraphs max\n4. Liberal whitespace between sections\n5. Keep SHORT - under 150 words\n\n=== BANNED PHRASES ===\n- "sign of growth" / "behind the scenes" / "the journey is messy"\n- "here\'s the thing" / "let me be honest" / "the truth is"\n- "at the end of the day" / "it\'s not about X, it\'s about Y"\n- "game changer" / "level up" / "lean in" / "double down"\n- "move the needle" / "deep dive" / "unpack" / "circle back"\n- "low-hanging fruit" / "synergy" / "pivot" / "authentic"\n- "vulnerability is strength" / "fail forward" / "growth mindset"\n- "imposter syndrome" / "that\'s the real flex" / "do the work"\n- "trust the process" / "bet on yourself" / "your network is your net worth"\n\nKILL THE POLITE LINKEDIN VOICE:\nNever hedge. Never soften. Own your take completely.\n\nBANNED HEDGE PHRASES:\n- "I think..." / "I believe..." / "I feel like..."\n- "In my experience..." / "From what I\'ve seen..."\n- "It might be worth considering..."\n- "This may not apply to everyone, but..."\n- "I could be wrong, but..." / "Just my two cents..."\n\nINSTEAD: State it as fact. Let them disagree.\n- NOT: "I think cold outreach is dead" â†’ "Cold outreach is dead."\n- NOT: "In my experience, most meetings are useless" â†’ "Most meetings are useless."\n\nTHE QUOTABLE LINE (Every post needs one):\nEvery post must have ONE line sharp enough to screenshot or steal.\n- Tweet-length (under 100 characters)\n- Punchy, slightly uncomfortable truth\n- Could stand alone as a post itself\n\nQUOTABLE LINE EXAMPLES:\n- "Busy is the new lazy."\n- "Your backup plan is why your main plan isn\'t working."\n- "Comfort is where ambition goes to die."\n- "Nobody cares about your journey. They care about your results."\n\nENDING RULES (no soft landings):\n- End on certainty, not questions\n- End on action, not reflection\n- Bad endings: trailing off, vague inspiration, "just my thoughts"\n\nBANNED LINKEDIN CRINGE:\n- Hashtags anywhere\n- Emojis as bullet points\n- "Agree?" or "Thoughts?" endings\n- "Let that sink in" / "Read that again"\n- Numbered "lessons" or "tips" lists\n- Humble brags disguised as stories\n- Single-word hook lines like "Stop."\n\nReturn ONLY the formatted post. Nothing else.';

        // Check if key is LTG Vault key
        function isLtgvKey(key) {
            return key && key.indexOf('ltgv_') === 0;
        }

        // Check if key is OpenAI key
        function isOpenAIKey(key) {
            return key && key.indexOf('sk-') === 0;
        }

        // Free trial constants
        var FREE_TRIAL_LIMIT = 3;
        var FREE_TRIAL_KEY = 'postup_free_uses';
        var apiKeyValid = false;  // Track if stored API key is valid
        var isSubscribed = false; // Track if subscribed to THIS tool specifically

        // Get remaining free trial uses
        function getFreeTrialUses() {
            var uses = localStorage.getItem(FREE_TRIAL_KEY);
            if (uses === null) {
                // First visit - set initial free trial
                localStorage.setItem(FREE_TRIAL_KEY, FREE_TRIAL_LIMIT);
                return FREE_TRIAL_LIMIT;
            }
            var parsedUses = parseInt(uses, 10);
            // Cap at limit (in case limit was reduced)
            if (parsedUses > FREE_TRIAL_LIMIT) {
                localStorage.setItem(FREE_TRIAL_KEY, FREE_TRIAL_LIMIT);
                return FREE_TRIAL_LIMIT;
            }
            return parsedUses;
        }

        // Decrement free trial uses
        function decrementFreeTrial() {
            var uses = getFreeTrialUses();
            if (uses > 0) {
                localStorage.setItem(FREE_TRIAL_KEY, uses - 1);
            }
            return uses - 1;
        }

        // Update free trial UI
        function updateFreeTrialUI(isSubscribed) {
            var usageCounter = document.getElementById('usageCounter');
            var usageText = document.getElementById('usageText');

            // If user is subscribed, show unlimited
            if (isSubscribed) {
                if (usageCounter) {
                    usageCounter.className = 'usage-counter unlimited';
                    usageText.innerHTML = '<span class="count">Unlimited</span> <span class="label">uses</span>';
                }
                apiStatus.textContent = 'Subscribed';
                apiStatus.className = 'api-status active';
                generateBtn.disabled = false;
                return;
            }

            var uses = getFreeTrialUses();

            // Update visual counter
            if (usageCounter && usageText) {
                if (uses > 0) {
                    usageCounter.className = 'usage-counter';
                    usageText.innerHTML = '<span class="count">' + uses + '</span> <span class="label">free ' + (uses === 1 ? 'use' : 'uses') + ' left</span>';
                    generateBtn.disabled = false;
                } else {
                    usageCounter.className = 'usage-counter exhausted';
                    usageText.innerHTML = '<span class="count">0</span> <span class="label">uses left</span> Â· <a href="/pricing.html">Get unlimited</a>';
                    generateBtn.disabled = true;
                }
            }

            // Update old status text
            var statusText = uses + ' free ' + (uses === 1 ? 'use' : 'uses') + ' remaining';
            apiStatus.textContent = statusText;
            apiStatus.className = 'api-status ' + (uses > 0 ? 'free-trial' : 'expired');

            if (uses <= 0) {
                showError('Free trial ended. <a href="/pricing.html">Subscribe for unlimited access</a>');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadApiKey();
            updateCharCounts();
            startDemoAnimation();
        });

        // Animated Demo
        function startDemoAnimation() {
            var demoInput = document.getElementById('demoInput');
            var demoOutput = document.getElementById('demoOutput');
            var demoButton = document.getElementById('demoButton');

            if (!demoInput || !demoOutput || !demoButton) return;

            var inputText = "just learned that taking breaks actually makes you more productive not less";
            var outputText = "Plot twist: The most productive thing you can do right now might be... nothing.\n\nI used to grind 12-hour days thinking that's what success looked like.\n\nThen I learned the science: Your brain needs downtime to consolidate learning and spark creativity.\n\nTake the break. You've earned it.";

            function runAnimation() {
                // Reset
                demoInput.innerHTML = '<span class="cursor"></span>';
                demoOutput.innerHTML = '';
                demoButton.classList.remove('active', 'clicked');

                var inputIndex = 0;
                var outputIndex = 0;

                // Phase 1: Type input
                function typeInput() {
                    if (inputIndex < inputText.length) {
                        demoInput.innerHTML = inputText.substring(0, inputIndex + 1) + '<span class="cursor"></span>';
                        inputIndex++;
                        setTimeout(typeInput, 40);
                    } else {
                        demoInput.innerHTML = inputText;
                        setTimeout(clickButton, 500);
                    }
                }

                // Phase 2: Click button
                function clickButton() {
                    demoButton.classList.add('active');
                    setTimeout(function() {
                        demoButton.classList.add('clicked');
                        setTimeout(function() {
                            demoButton.classList.remove('clicked');
                            demoOutput.classList.add('generating');
                            setTimeout(typeOutput, 300);
                        }, 150);
                    }, 300);
                }

                // Phase 3: Type output
                function typeOutput() {
                    if (outputIndex < outputText.length) {
                        demoOutput.textContent = outputText.substring(0, outputIndex + 1);
                        outputIndex++;
                        setTimeout(typeOutput, 15);
                    } else {
                        demoOutput.classList.remove('generating');
                        // Pause then restart
                        setTimeout(runAnimation, 3000);
                    }
                }

                setTimeout(typeInput, 500);
            }

            runAnimation();
        }

        // Load API Key from localStorage (check both storage keys)
        function loadApiKey() {
            var ltgvKey = localStorage.getItem('ltgv_api_key');

            if (ltgvKey) {
                apiKeyInput.value = ltgvKey;
                updateApiStatus('ltgv');
                generateBtn.disabled = false;
                // Check subscription status
                checkSubscriptionStatus(ltgvKey);
            } else {
                // No API key - use free trial mode
                updateFreeTrialUI();
            }
        }

        // Check subscription status and update Subscribe buttons if subscribed
        function checkSubscriptionStatus(apiKey) {
            console.log('=== SUBSCRIPTION CHECK DEBUG ===');
            console.log('Calling /api/keys with key:', apiKey ? apiKey.substring(0, 10) + '...' : 'none');

            fetch('/api/keys', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey
                }
            })
            .then(function(response) {
                console.log('API response status:', response.status);
                // Handle invalid/revoked API keys
                if (response.status === 401) {
                    console.log('API key is invalid or revoked - removing from localStorage');
                    localStorage.removeItem('ltgv_api_key');
                    apiKeyInput.value = '';
                    apiKeyValid = false;
                    updateFreeTrialUI(false);
                    return { success: false, invalid: true };
                }
                return response.json();
            })
            .then(function(data) {
                if (data.invalid) {
                    // Already handled above
                    return;
                }
                console.log('API response data:', JSON.stringify(data, null, 2));
                console.log('data.subscriptions.postup:', data.subscriptions ? data.subscriptions.postup : 'N/A');

                if (data.success && data.subscriptions && data.subscriptions.postup) {
                    console.log('User is subscribed to PostUp - updating buttons');
                    apiKeyValid = true;
                    isSubscribed = true;
                    // Update usage counter to show unlimited
                    updateFreeTrialUI(true);
                    // Update all subscribe buttons to show subscribed state
                    var subscribeButtons = document.querySelectorAll('.btn-subscribe');
                    subscribeButtons.forEach(function(btn) {
                        btn.textContent = 'Subscribed âœ“';
                        btn.classList.add('btn-subscribed');
                        btn.onclick = function(e) {
                            e.preventDefault();
                            alert('You\'re already subscribed to PostUp! Manage your subscription in the dashboard.');
                        };
                    });
                    // Update the bottom CTA text
                    var ctaText = document.querySelector('#bottomCta p');
                    if (ctaText) {
                        ctaText.textContent = 'You have unlimited access to PostUp.';
                    }
                } else if (data.success) {
                    // Key is valid but NOT subscribed to PostUp
                    console.log('User not subscribed to PostUp, but key is valid');
                    apiKeyValid = true;
                    isSubscribed = false;
                    updateFreeTrialUI(false);
                } else {
                    console.log('API key validation failed');
                    apiKeyValid = false;
                    isSubscribed = false;
                    updateFreeTrialUI(false);
                }
                console.log('=== END SUBSCRIPTION CHECK ===');
            })
            .catch(function(err) {
                console.log('Subscription check ERROR:', err);
                apiKeyValid = false;
                updateFreeTrialUI(false);
            });
        }

        // Save API Key
        saveKeyBtn.addEventListener('click', function() {
            var key = apiKeyInput.value.trim();

            if (!key) {
                showError('Please enter your LTG Vault API key.');
                return;
            }

            if (isLtgvKey(key)) {
                localStorage.setItem('ltgv_api_key', key);
                updateApiStatus('ltgv');
                generateBtn.disabled = false;
                hideError();
                // Check subscription status for newly saved key
                checkSubscriptionStatus(key);
            } else {
                showError('Invalid API key format. Get your ltgv_... key from the dashboard.');
                return;
            }
        });

        // Update API Status
        function updateApiStatus(type) {
            if (type === 'ltgv') {
                apiStatus.textContent = 'Subscribed âœ“';
                apiStatus.className = 'api-status saved';
                usageInfo.style.display = 'none';
            } else {
                // Free trial mode - will be updated by updateFreeTrialUI
                updateFreeTrialUI();
            }
        }

        // Update usage display
        function updateUsageDisplay(usage) {
            if (usage) {
                var limitText = usage.limit === 'unlimited' ? 'unlimited' : usage.limit;
                usageInfo.textContent = 'Usage this month: ' + usage.used + ' / ' + limitText;
                usageInfo.style.display = 'block';
            }
        }

        // Character counts
        inputText.addEventListener('input', updateCharCounts);
        outputText.addEventListener('input', updateCharCounts);

        function updateCharCounts() {
            inputCount.textContent = inputText.value.length + ' chars';
            outputCount.textContent = outputText.value.length + ' chars';
        }

        // Generate Post
        generateBtn.addEventListener('click', function() {
            var text = inputText.value.trim();
            var ltgvKey = localStorage.getItem('ltgv_api_key');
            var freeTrialUses = getFreeTrialUses();

            if (!text) {
                showError('Please enter some text to transform.');
                return;
            }

            // Check if user has access (subscribed or free trial)
            // Block if not subscribed AND no free uses left
            if ((!ltgvKey || !apiKeyValid || !isSubscribed) && freeTrialUses <= 0) {
                showError('Free trial ended. <a href="/pricing.html">Subscribe for unlimited access</a>');
                return;
            }

            setLoading(true);
            hideError();
            hideExtras();

            // Get settings
            var tone = document.getElementById('toneSelect').value;
            var inputType = document.getElementById('inputTypeSelect').value;
            var niche = document.getElementById('nicheSelect').value;

            // Determine mode - use free trial if no key OR invalid key OR not subscribed to THIS tool
            var isFreeTrial = !ltgvKey || !apiKeyValid || !isSubscribed;
            var headers = {
                'Content-Type': 'application/json'
            };

            if (ltgvKey) {
                headers['x-api-key'] = ltgvKey;
                console.log('=== POSTUP DEBUG ===');
                console.log('MODE: LTG Vault API (Subscribed)');
                console.log('Using API Key:', ltgvKey.substring(0, 10) + '...');
            } else {
                headers['x-free-trial'] = 'true';
                console.log('=== POSTUP DEBUG ===');
                console.log('MODE: Free Trial');
                console.log('Uses remaining:', freeTrialUses);
            }
            console.log('Tone:', tone);
            console.log('Input Type:', inputType);
            console.log('Niche:', niche);

            // Use LTG Vault API
            fetch('/api/tools/postup', {
                method: 'POST',
                headers: headers,
                    body: JSON.stringify({
                        content: text,
                        tone: tone,
                        inputType: inputType,
                        niche: niche || undefined
                    })
                })
                .then(function(response) {
                    return response.json().then(function(data) {
                        if (!response.ok) {
                            if (data.error === 'LIMIT_EXCEEDED') {
                                throw new Error(data.message + ' <a href="/pricing.html">pricing</a>');
                            }
                            throw new Error(data.error || 'API request failed.');
                        }
                        return data;
                    });
                })
                .then(function(data) {
                    // LOG DEBUG INFO FROM API
                    console.log('=== API RESPONSE DEBUG ===');
                    console.log('Success:', data.success);
                    if (data._debug) {
                        console.log('API Version:', data._debug.version);
                        console.log('Model:', data._debug.model);
                        console.log('Provider:', data._debug.apiProvider);
                        console.log('System Prompt Length:', data._debug.systemPromptLength);
                        console.log('System Prompt Start:', data._debug.systemPromptStart);
                    } else {
                        console.log('WARNING: No _debug info in response');
                    }
                    console.log('=== END API DEBUG ===');

                    // Handle new JSON response with variations
                    var result = data.result;

                    // FRONTEND FILTER: Remove em dashes as backup
                    function stripEmDashes(text) {
                        if (!text) return text;
                        var emCount = (text.match(/â€”/g) || []).length;
                        var enCount = (text.match(/â€“/g) || []).length;
                        if (emCount > 0 || enCount > 0) {
                            console.log('FRONTEND EM DASH FILTER: Found', emCount, 'em dashes and', enCount, 'en dashes');
                        }
                        return text
                            .replace(/â€”/g, ', ')
                            .replace(/â€“/g, ', ')
                            .replace(/  +/g, ' ')
                            .replace(/ ,/g, ',');
                    }

                    // Clean all variations
                    if (result && result.variations) {
                        console.log('FILTERING VARIATIONS:', result.variations.length);
                        result.variations = result.variations.map(function(v) {
                            return {
                                hookLine: stripEmDashes(v.hookLine),
                                content: stripEmDashes(v.content)
                            };
                        });
                    }

                    if (result && result.variations && result.variations.length > 0) {
                        // Store full result for later use
                        window.lastPostUpResult = result;
                        // Display first variation
                        outputText.value = result.variations[0].content;
                        // Show variation selector if multiple variations
                        showVariationSelector(result.variations);
                        // Show hook alternatives
                        showHookAlternatives(result.hookAlternatives);
                        // Show improvement tips
                        showImprovementTips(result.improvementTips);
                        // Show confidence score
                        showConfidenceScore(result.confidenceScore);
                    } else if (typeof result === 'string') {
                        // Fallback for plain text response
                        outputText.value = result;
                        hideExtras();
                    } else {
                        outputText.value = JSON.stringify(result, null, 2);
                        hideExtras();
                    }
                    copyBtn.disabled = false;
                    updateCharCounts();
                    // Show quick actions and LinkedIn preview
                    showQuickActions();
                    updateLinkedInPreview(outputText.value);

                    // Decrement free trial if applicable
                    if (isFreeTrial) {
                        var remaining = decrementFreeTrial();
                        updateFreeTrialUI();
                        console.log('Free trial uses remaining:', remaining);
                    } else if (data.usage) {
                        updateUsageDisplay(data.usage);
                    }
                })
                .catch(function(error) {
                    errorMessage.innerHTML = error.message || 'Failed to generate post. Please try again.';
                    errorMessage.style.display = 'block';
                })
                .finally(function() {
                    setLoading(false);
                });
        });

        // Copy to Clipboard
        copyBtn.addEventListener('click', function() {
            var text = outputText.value;
            if (!text) return;

            navigator.clipboard.writeText(text).then(function() {
                copyBtn.classList.add('copied');
                copyText.textContent = 'Copied!';

                setTimeout(function() {
                    copyBtn.classList.remove('copied');
                    copyText.textContent = 'Copy to Clipboard';
                }, 2000);
            }).catch(function() {
                showError('Failed to copy to clipboard.');
            });
        });

        // Loading State
        function setLoading(loading) {
            generateBtn.disabled = loading;
            generateBtn.classList.toggle('loading', loading);
            inputText.disabled = loading;
        }

        // Error Handling
        function showError(message) {
            errorMessage.innerHTML = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        // ============ VARIATION SELECTOR ============
        function showVariationSelector(variations) {
            var selector = document.getElementById('variationSelector');
            var tabs = document.getElementById('variationTabs');

            if (!variations || variations.length <= 1) {
                selector.classList.remove('visible');
                return;
            }

            tabs.innerHTML = '';

            for (var i = 0; i < variations.length; i++) {
                var tab = document.createElement('button');
                tab.className = 'variation-tab' + (i === 0 ? ' active' : '');
                tab.textContent = 'Version ' + (i + 1);
                tab.setAttribute('data-index', i);
                tab.onclick = function() {
                    var index = parseInt(this.getAttribute('data-index'));
                    selectVariation(index);
                };
                tabs.appendChild(tab);
            }

            selector.classList.add('visible');
        }

        function selectVariation(index) {
            var result = window.lastPostUpResult;
            if (!result || !result.variations || !result.variations[index]) return;

            outputText.value = result.variations[index].content;
            updateCharCounts();

            // Update active tab
            var tabs = document.querySelectorAll('.variation-tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            tabs[index].classList.add('active');
        }

        // ============ HOOK ALTERNATIVES ============
        function showHookAlternatives(hooks) {
            var container = document.getElementById('hookAlternatives');
            var list = document.getElementById('hookList');

            if (!hooks || hooks.length === 0) {
                container.classList.remove('visible');
                return;
            }

            list.innerHTML = '';

            for (var i = 0; i < hooks.length; i++) {
                var hook = hooks[i];
                var item = document.createElement('div');
                item.className = 'hook-item';
                item.innerHTML = '<span class="hook-text">' + escapeHtml(hook.text) + '</span>' +
                    '<span class="hook-style">' + escapeHtml(hook.style || 'hook') + '</span>' +
                    '<button class="use-btn" data-hook="' + escapeHtml(hook.text) + '">Use This</button>';

                var useBtn = item.querySelector('.use-btn');
                useBtn.onclick = function(e) {
                    e.stopPropagation();
                    var hookText = this.getAttribute('data-hook');
                    applyHook(hookText);
                };

                item.onclick = function() {
                    var hookText = this.querySelector('.hook-text').textContent;
                    applyHook(hookText);
                };

                list.appendChild(item);
            }

            container.classList.add('visible');
        }

        function applyHook(hookText) {
            var currentText = outputText.value;

            // Replace first line with new hook
            var lines = currentText.split('\n');
            lines[0] = hookText;
            outputText.value = lines.join('\n');

            updateCharCounts();
            copyBtn.disabled = false;
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============ IMPROVEMENT TIPS ============
        function showImprovementTips(tips) {
            var container = document.getElementById('improvementTips');
            var list = document.getElementById('tipsList');

            if (!tips || tips.length === 0) {
                container.classList.remove('visible');
                return;
            }

            list.innerHTML = '';

            for (var i = 0; i < tips.length; i++) {
                var item = document.createElement('div');
                item.className = 'tip-item';
                item.innerHTML = '<span class="tip-bullet">â€¢</span><span>' + escapeHtml(tips[i]) + '</span>';
                list.appendChild(item);
            }

            container.classList.add('visible');
        }

        // ============ CONFIDENCE SCORE ============
        function showConfidenceScore(score) {
            var container = document.getElementById('confidenceScore');
            var valueEl = document.getElementById('confidenceValue');

            if (!score && score !== 0) {
                container.classList.remove('visible');
                return;
            }

            valueEl.textContent = score + '%';
            valueEl.className = 'confidence-value';

            if (score >= 70) {
                valueEl.classList.add('high');
            } else if (score >= 40) {
                valueEl.classList.add('medium');
            } else {
                valueEl.classList.add('low');
            }

            container.classList.add('visible');
        }

        // ============ HIDE EXTRAS ============
        function hideExtras() {
            document.getElementById('variationSelector').classList.remove('visible');
            document.getElementById('hookAlternatives').classList.remove('visible');
            document.getElementById('improvementTips').classList.remove('visible');
            document.getElementById('confidenceScore').classList.remove('visible');
            document.getElementById('quickActions').classList.remove('visible');
            document.getElementById('linkedinPreviewSection').classList.remove('visible');
        }

        // ============ QUICK ACTIONS ============
        function showQuickActions() {
            document.getElementById('quickActions').classList.add('visible');
        }

        // Quick action button handlers
        document.querySelectorAll('.quick-action-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var action = this.getAttribute('data-action');
                var currentPost = outputText.value.trim();

                if (!currentPost) {
                    showError('Generate a post first before using quick actions.');
                    return;
                }

                var ltgvKey = localStorage.getItem('ltgv_api_key');
                if (!ltgvKey) {
                    showError('Quick actions require an LTG Vault API key.');
                    return;
                }

                // Set loading state
                var originalText = this.innerHTML;
                this.classList.add('loading');
                this.innerHTML = '<span class="spinner-small"></span> Processing...';
                document.querySelectorAll('.quick-action-btn').forEach(function(b) { b.disabled = true; });

                fetch('/api/tools/postup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': ltgvKey
                    },
                    body: JSON.stringify({
                        content: inputText.value,
                        action: action,
                        currentPost: currentPost
                    })
                })
                .then(function(response) {
                    return response.json().then(function(data) {
                        if (!response.ok) {
                            throw new Error(data.error || 'Quick action failed.');
                        }
                        return data;
                    });
                })
                .then(function(data) {
                    outputText.value = data.result;
                    updateCharCounts();
                    updateLinkedInPreview(data.result);
                    if (data.usage) {
                        updateUsageDisplay(data.usage);
                    }
                })
                .catch(function(error) {
                    showError(error.message || 'Quick action failed. Please try again.');
                })
                .finally(function() {
                    btn.classList.remove('loading');
                    btn.innerHTML = originalText;
                    document.querySelectorAll('.quick-action-btn').forEach(function(b) { b.disabled = false; });
                });
            });
        });

        // ============ LINKEDIN PREVIEW ============
        function updateLinkedInPreview(text) {
            if (!text) {
                document.getElementById('linkedinPreviewSection').classList.remove('visible');
                return;
            }

            document.getElementById('linkedinPreviewSection').classList.add('visible');

            // LinkedIn shows about 210 characters before "see more"
            var cutoffLength = 210;
            var previewText = document.getElementById('previewText');
            var seeMoreBtn = document.getElementById('seeMoreBtn');
            var fullPreview = document.getElementById('linkedinPreviewFull');

            if (text.length > cutoffLength) {
                // Find a good breaking point (end of word)
                var breakPoint = text.lastIndexOf(' ', cutoffLength);
                if (breakPoint === -1) breakPoint = cutoffLength;

                previewText.textContent = text.substring(0, breakPoint);
                seeMoreBtn.style.display = 'inline';
                fullPreview.textContent = text.substring(breakPoint);
            } else {
                previewText.textContent = text;
                seeMoreBtn.style.display = 'none';
                fullPreview.textContent = '';
            }

            // Update stats
            var charCount = text.length;
            var wordCount = text.trim().split(/\s+/).filter(function(w) { return w.length > 0; }).length;
            var lineCount = text.split('\n').length;

            var charEl = document.getElementById('previewCharCount');
            charEl.textContent = charCount + ' / 3000 chars';
            charEl.className = 'preview-stat';
            if (charCount > 3000) {
                charEl.classList.add('danger');
            } else if (charCount > 2500) {
                charEl.classList.add('warning');
            }

            document.getElementById('previewWordCount').textContent = wordCount + ' words';
            document.getElementById('previewLineCount').textContent = lineCount + ' lines';
        }

        // See more toggle
        document.getElementById('seeMoreBtn').addEventListener('click', function() {
            var fullPreview = document.getElementById('linkedinPreviewFull');
            fullPreview.classList.toggle('expanded');
            this.textContent = fullPreview.classList.contains('expanded') ? '...see less' : '...see more';
        });

        // Update preview when output changes
        outputText.addEventListener('input', function() {
            updateLinkedInPreview(this.value);
        });

        // ============ FEEDBACK FORM ============
        (function() {
            var feedbackForm = document.getElementById('feedbackForm');
            var feedbackText = document.getElementById('feedbackText');
            var feedbackSubmit = document.getElementById('feedbackSubmit');
            var feedbackSuccess = document.getElementById('feedbackSuccess');
            var feedbackError = document.getElementById('feedbackError');

            if (feedbackForm) {
                feedbackForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    var message = feedbackText.value.trim();
                    if (!message) return;

                    feedbackSubmit.disabled = true;
                    feedbackSubmit.textContent = 'Sending...';
                    feedbackSuccess.classList.remove('visible');
                    feedbackError.classList.remove('visible');

                    // Send to Formspree (replace YOUR_FORM_ID with your actual Formspree form ID)
                    fetch('https://formspree.io/f/xdkogjkq', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            tool: 'PostUp',
                            message: message
                        })
                    })
                    .then(function(response) {
                        if (response.ok) {
                            feedbackSuccess.classList.add('visible');
                            feedbackText.value = '';
                            feedbackForm.style.display = 'none';
                        } else {
                            throw new Error('Failed');
                        }
                    })
                    .catch(function() {
                        feedbackError.classList.add('visible');
                    })
                    .finally(function() {
                        feedbackSubmit.disabled = false;
                        feedbackSubmit.textContent = 'Submit Feedback';
                    });
                });
            }
        })();

    </script>

</body>
</html>
