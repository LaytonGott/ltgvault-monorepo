<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThreadGen | LTG Vault</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="64x64" href="favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --black: #000000;
            --bg-dark: #0a0a0a;
            --bg-card: #111111;
            --bg-input: #0a0a0a;
            --gold: #C9A227;
            --gold-light: #D4AF37;
            --gold-dim: rgba(201, 162, 39, 0.15);
            --white: #FFFFFF;
            --gray: #888888;
            --gray-light: #AAAAAA;
            --gray-dark: #333333;
            --border: rgba(255, 255, 255, 0.08);
            --success: #28ca41;
            --error: #ff5f57;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--black);
            color: var(--white);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* ============ HEADER ============ */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 76px;
            background: rgba(0, 0, 0, 0.95);
            border-bottom: 2px solid #4a3d2a;
            backdrop-filter: blur(12px);
            transition: all 0.3s ease;
        }

        header.scrolled {
            background: rgba(0, 0, 0, 0.98);
        }

        .header-inner {
            max-width: 1100px;
            height: 100%;
            margin: 0 auto;
            padding: 0 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo-img {
            height: 236px;
            width: auto;
            display: block;
            margin-top: 15px;
        }

        nav {
            display: flex;
            align-items: center;
            gap: 36px;
        }

        nav a {
            color: #aaaaaa;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 500;
            transition: color 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        nav a:hover {
            color: var(--white);
        }

        nav a.active {
            color: var(--gold);
        }

        /* Main Container */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 60px 40px;
            padding-top: 100px;
        }

        /* Header Responsive */
        @media (max-width: 1024px) {
            .header-inner {
                padding: 0 24px;
            }
            nav {
                gap: 24px;
            }
            nav a {
                font-size: 1rem;
            }
            .logo-img {
                height: 70px;
            }
            .container {
                padding: 0 24px;
                padding-top: 100px;
            }
        }

        @media (max-width: 768px) {
            header {
                height: auto;
                padding: 12px 0;
            }
            .header-inner {
                flex-direction: column;
                gap: 12px;
            }
            .logo-img {
                height: 180px;
            }
            nav {
                width: 100%;
                justify-content: center;
                gap: 20px;
                flex-wrap: wrap;
            }
            nav a {
                font-size: 0.9rem;
            }
            .container {
                padding-top: 20px;
            }
        }

        @media (max-width: 480px) {
            .logo-img {
                height: 150px;
            }
            nav {
                gap: 16px;
            }
            nav a {
                font-size: 0.85rem;
            }
        }

        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .page-title svg {
            color: var(--gold);
        }

        .page-subtitle {
            color: var(--gray);
            font-size: 0.95rem;
            margin-bottom: 32px;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .char-count {
            font-size: 0.75rem;
            color: var(--gray);
        }

        /* Status Messages */
        .status {
            padding: 14px 18px;
            border-radius: 10px;
            font-size: 0.9rem;
            margin-bottom: 16px;
            display: none;
            line-height: 1.5;
        }

        .status.visible {
            display: block;
        }

        .status.error {
            background: rgba(201, 162, 39, 0.1);
            border: 1px solid rgba(201, 162, 39, 0.3);
            color: var(--gold);
        }

        .status.error a {
            color: var(--white);
            text-decoration: underline;
            font-weight: 600;
        }

        .status.error a:hover {
            color: var(--gold-light);
        }

        .status.success {
            background: rgba(40, 202, 65, 0.1);
            border: 1px solid rgba(40, 202, 65, 0.3);
            color: var(--success);
        }

        .status.info {
            background: var(--gold-dim);
            border: 1px solid rgba(201, 162, 39, 0.3);
            color: var(--gold);
        }

        .status a {
            color: var(--gold);
            text-decoration: underline;
        }

        .status a:hover {
            color: var(--gold-light);
        }

        /* Input Groups */
        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            transition: border-color 0.2s ease;
        }

        .input-wrapper:focus-within {
            border-color: var(--gold);
        }

        .input-wrapper input {
            flex: 1;
            background: none;
            border: none;
            color: var(--white);
            font-size: 0.9rem;
            padding: 14px 16px;
            outline: none;
            font-family: inherit;
        }

        .input-wrapper input::placeholder {
            color: #555;
        }

        textarea {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--white);
            font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
            padding: 14px 16px;
            resize: vertical;
            min-height: 200px;
            outline: none;
            transition: border-color 0.2s ease;
            line-height: 1.6;
        }

        textarea:focus {
            border-color: rgba(201, 162, 39, 0.5);
            box-shadow: 0 0 0 3px rgba(201, 162, 39, 0.1);
        }

        textarea {
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        /* Output fade-in animation */
        textarea.fade-in,
        .text-area.fade-in {
            animation: fadeInContent 0.25s ease-out;
        }

        @keyframes fadeInContent {
            from { opacity: 0.5; }
            to { opacity: 1; }
        }

        textarea::placeholder {
            color: #555;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.primary {
            background: var(--gold);
            color: var(--black);
            width: 100%;
        }

        .btn.primary:hover:not(:disabled) {
            background: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(201, 162, 39, 0.4), 0 0 0 1px rgba(201, 162, 39, 0.2);
        }

        .btn.primary:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(201, 162, 39, 0.3);
        }

        .btn.primary .btn-text {
            display: inline;
        }

        .btn.primary .btn-loading-text {
            display: none;
        }

        .btn.primary.loading .btn-text {
            display: none;
        }

        .btn.primary.loading .btn-loading-text {
            display: inline;
        }

        .btn.secondary {
            background: var(--gold-dim);
            border: 1px solid rgba(201, 162, 39, 0.3);
            color: var(--gold);
        }

        .btn.secondary:hover:not(:disabled) {
            background: rgba(201, 162, 39, 0.25);
        }

        .btn.secondary.copied {
            background: rgba(40, 202, 65, 0.15);
            border-color: var(--success);
            color: var(--success);
        }

        .btn.secondary .copy-icon {
            transition: opacity 0.15s ease;
        }

        .btn.secondary.copied .copy-icon {
            display: none;
        }

        .btn.secondary .check-icon {
            display: none;
        }

        .btn.secondary.copied .check-icon {
            display: inline;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: var(--gray-dark);
            color: var(--white);
        }

        /* Free Trial Counter */
        .usage-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }

        .usage-counter svg {
            color: var(--gold);
            flex-shrink: 0;
        }

        .usage-counter .count {
            font-weight: 600;
            color: var(--gold);
        }

        .usage-counter .label {
            color: var(--gray-light);
        }

        .usage-counter a {
            color: var(--gold);
            text-decoration: none;
            font-weight: 500;
        }

        .usage-counter a:hover {
            text-decoration: underline;
        }

        .usage-counter.exhausted {
            border-color: rgba(255, 95, 87, 0.3);
            background: rgba(255, 95, 87, 0.05);
        }

        .usage-counter.exhausted .count {
            color: var(--error);
        }

        .usage-counter.exhausted svg {
            color: var(--error);
        }

        .usage-counter.unlimited {
            border-color: rgba(40, 202, 65, 0.3);
            background: rgba(40, 202, 65, 0.05);
        }

        .usage-counter.unlimited .count {
            color: var(--success);
        }

        .usage-counter.unlimited svg {
            color: var(--success);
        }

        .usage-counter.hidden {
            display: none;
        }

        /* Settings Panel */
        .settings-panel {
            display: none;
        }

        .settings-panel.visible {
            display: block;
        }

        .settings-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .settings-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .hint {
            font-size: 0.75rem;
            color: #666;
            margin-top: 12px;
        }

        .hint a {
            color: var(--gold);
            text-decoration: none;
        }

        .hint a:hover {
            text-decoration: underline;
        }

        /* Loading */
        .loading {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 40px;
            gap: 16px;
        }

        .loading.visible {
            display: flex;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--gray-dark);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading p {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Results */
        .results {
            display: none;
            margin-top: 24px;
        }

        .results.visible {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .results-title {
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Tweet Cards */
        .tweets-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .tweet-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .tweet-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.02);
            border-bottom: 1px solid var(--border);
        }

        .tweet-number {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gold);
        }

        .tweet-char-count {
            font-size: 0.7rem;
            color: var(--gray);
        }

        .tweet-content {
            padding: 16px;
            font-size: 0.9rem;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .tweet-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 12px 16px;
            border-top: 1px solid var(--border);
        }

        .copy-tweet-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--gray-light);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .copy-tweet-btn:hover {
            background: var(--gray-dark);
            color: var(--white);
            border-color: var(--gray);
        }

        .copy-tweet-btn.copied {
            background: rgba(40, 202, 65, 0.15);
            border-color: var(--success);
            color: var(--success);
        }

        /* Footer */
        footer {
            padding: 24px 0;
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }

        .footer-inner {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 40px;
            text-align: center;
        }

        .footer-text {
            font-size: 0.8rem;
            color: #555;
        }

        /* ============ BEFORE/AFTER SECTION ============ */
        .before-after {
            margin-bottom: 32px;
        }

        .before-after-title {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            text-align: center;
            margin-bottom: 16px;
        }

        .before-after-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 0;
            align-items: stretch;
        }

        .before-box, .after-box {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }

        .before-box {
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .after-box {
            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            border-color: rgba(201, 162, 39, 0.3);
            background: rgba(201, 162, 39, 0.03);
        }

        .box-label {
            font-size: 0.6rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 10px;
        }

        .after-box .box-label {
            color: var(--gold);
        }

        .box-content {
            font-size: 0.8rem;
            line-height: 1.5;
            color: #888;
        }

        .after-box .box-content {
            color: #ccc;
        }

        .thread-tweet {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 6px;
            padding: 8px 10px;
            margin-bottom: 6px;
            font-size: 0.75rem;
        }

        .thread-tweet:last-child {
            margin-bottom: 0;
        }

        .thread-num {
            font-size: 0.6rem;
            color: var(--gold);
            font-weight: 600;
            margin-bottom: 3px;
        }

        .before-after-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            color: var(--gold);
            font-size: 1.2rem;
            background: linear-gradient(to right, rgba(255,255,255,0.02), rgba(201,162,39,0.03));
        }

        @media (max-width: 600px) {
            .before-after-grid {
                grid-template-columns: 1fr;
                gap: 0;
            }
            .before-box {
                border-radius: 12px 12px 0 0;
                border-right: 1px solid var(--border);
                border-bottom: none;
            }
            .after-box {
                border-radius: 0 0 12px 12px;
                border-left: 1px solid rgba(201, 162, 39, 0.3);
                border-top: none;
            }
            .before-after-arrow {
                padding: 8px 0;
                background: linear-gradient(to bottom, rgba(255,255,255,0.02), rgba(201,162,39,0.03));
            }
        }

        /* ============ ANIMATED DEMO SECTION ============ */
        .demo-section {
            margin-bottom: 32px;
        }

        .demo-title {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            text-align: center;
            margin-bottom: 16px;
        }

        /* Demo matches real tool styling exactly */
        .demo-tool-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .demo-tool-panel {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 16px;
        }

        .demo-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .demo-panel-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .demo-char-count {
            font-size: 0.65rem;
            color: #555;
        }

        .demo-text-area {
            width: 100%;
            min-height: 160px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 14px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .demo-text-area .cursor {
            display: inline-block;
            width: 2px;
            height: 12px;
            background: var(--gold);
            margin-left: 1px;
            animation: blink 0.8s infinite;
            vertical-align: text-bottom;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .demo-text-area.input-area {
            color: #999;
        }

        .demo-text-area.output-area {
            color: var(--white);
        }

        .demo-button-row {
            margin-top: 12px;
        }

        .demo-generate-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--gold);
            color: var(--black);
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: default;
            transition: all 0.2s ease;
            opacity: 0.6;
        }

        .demo-generate-btn.ready {
            opacity: 1;
        }

        .demo-generate-btn.active {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(201, 162, 39, 0.3);
        }

        .demo-generate-btn.clicked {
            transform: scale(0.98);
            box-shadow: none;
        }

        .demo-generate-btn .demo-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid transparent;
            border-top-color: var(--black);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: none;
        }

        .demo-generate-btn.loading .demo-spinner {
            display: block;
        }

        .demo-generate-btn.loading .demo-btn-text {
            display: none;
        }

        .demo-tweet {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 8px;
            font-size: 0.7rem;
            line-height: 1.5;
        }

        .demo-tweet:last-child {
            margin-bottom: 0;
        }

        @media (max-width: 600px) {
            .demo-tool-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ============ TWO-COLUMN TOOL LAYOUT ============ */
        .tool-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .tool-panel {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .panel-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .text-area {
            width: 100%;
            min-height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            line-height: 1.7;
            resize: vertical;
        }

        .text-area:focus {
            outline: none;
            border-color: rgba(201, 162, 39, 0.4);
        }

        .text-area::placeholder {
            color: #555;
        }

        .text-area[readonly] {
            background: rgba(0, 0, 0, 0.2);
            cursor: default;
        }

        .button-row {
            margin-top: 16px;
        }

        .generate-btn {
            width: 100%;
            padding: 16px 24px;
            background: var(--gold);
            color: var(--black);
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .generate-btn:hover:not(:disabled) {
            background: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(201, 162, 39, 0.4), 0 0 0 1px rgba(201, 162, 39, 0.2);
        }

        .generate-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(201, 162, 39, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .generate-btn .spinner {
            display: none;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-top-color: var(--black);
        }

        .generate-btn .btn-loading-text { display: none; }
        .generate-btn.loading .btn-text { display: none; }
        .generate-btn.loading .btn-loading-text { display: inline; }
        .generate-btn.loading .spinner { display: block; }

        .copy-btn {
            width: 100%;
            padding: 14px 20px;
            background: var(--gold-dim);
            border: 1px solid rgba(201, 162, 39, 0.3);
            border-radius: 10px;
            color: var(--gold);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .copy-btn:hover:not(:disabled) {
            background: rgba(201, 162, 39, 0.25);
        }

        .copy-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .copy-btn.copied {
            background: rgba(40, 202, 65, 0.15);
            border-color: var(--success);
            color: var(--success);
        }

        .copy-btn .copy-icon {
            transition: opacity 0.15s ease;
        }

        .copy-btn.copied .copy-icon {
            display: none;
        }

        .copy-btn .check-icon {
            display: none;
        }

        .copy-btn.copied .check-icon {
            display: inline;
        }

        /* Text area focus enhancement */
        .text-area {
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .text-area:focus {
            border-color: rgba(201, 162, 39, 0.5);
            box-shadow: 0 0 0 3px rgba(201, 162, 39, 0.1);
        }

        .error-message {
            margin-top: 12px;
            padding: 14px 18px;
            background: rgba(201, 162, 39, 0.1);
            border: 1px solid rgba(201, 162, 39, 0.3);
            border-radius: 10px;
            color: var(--gold);
            font-size: 0.9rem;
            display: none;
            line-height: 1.5;
        }

        .error-message.visible { display: block; }

        .error-message a {
            color: var(--white);
            text-decoration: underline;
            font-weight: 600;
        }

        .error-message a:hover {
            color: var(--gold-light);
        }

        /* ============ TOOLTIP GUIDE ============ */
        .tooltip-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9998;
        }

        .tooltip-overlay.visible {
            display: block;
        }

        .tooltip-highlight {
            position: relative;
            z-index: 9999;
            box-shadow: 0 0 0 4px var(--gold), 0 0 20px rgba(201, 162, 39, 0.4);
            border-radius: 12px;
        }

        .tooltip-box {
            display: none;
            position: fixed;
            background: rgba(20, 20, 20, 0.98);
            border: 1px solid var(--gold);
            border-radius: 10px;
            padding: 16px 20px;
            max-width: 280px;
            z-index: 10000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .tooltip-box.visible {
            display: block;
        }

        .tooltip-box::before {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: rgba(20, 20, 20, 0.98);
            border: 1px solid var(--gold);
            border-right: none;
            border-bottom: none;
            transform: rotate(45deg);
        }

        .tooltip-box.arrow-top::before {
            top: -7px;
            left: 24px;
        }

        .tooltip-box.arrow-bottom::before {
            bottom: -7px;
            left: 24px;
            transform: rotate(225deg);
        }

        .tooltip-box.arrow-left::before {
            left: -7px;
            top: 20px;
            transform: rotate(-45deg);
        }

        .tooltip-step {
            font-size: 0.7rem;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 6px;
        }

        .tooltip-text {
            font-size: 0.9rem;
            color: var(--white);
            line-height: 1.5;
            margin-bottom: 14px;
        }

        .tooltip-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .tooltip-btn {
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .tooltip-btn-primary {
            background: var(--gold);
            color: var(--black);
        }

        .tooltip-btn-primary:hover {
            background: var(--gold-light);
        }

        .tooltip-btn-secondary {
            background: transparent;
            color: #888;
            border: 1px solid #444;
        }

        .tooltip-btn-secondary:hover {
            color: var(--white);
            border-color: #666;
        }

        /* Quick Actions */
        .quick-actions {
            display: none;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .quick-actions.visible { display: flex; }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 14px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: #999;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .quick-action-btn:hover {
            border-color: var(--gold);
            color: var(--gold);
            background: rgba(201, 162, 39, 0.1);
        }

        .quick-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Variation Selector */
        .variation-selector {
            display: none;
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .variation-selector.visible { display: block; }

        .variation-selector-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .variation-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .variation-tab {
            padding: 10px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--gray);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .variation-tab:hover {
            border-color: rgba(201, 162, 39, 0.4);
            color: var(--white);
        }

        .variation-tab.active {
            background: rgba(201, 162, 39, 0.15);
            border-color: var(--gold);
            color: var(--gold);
        }

        /* Alternatives Section */
        .alternatives-section {
            display: none;
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .alternatives-section.visible { display: block; }

        .alternatives-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .alternative-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .alternative-item:hover {
            border-color: rgba(201, 162, 39, 0.4);
        }

        .alternative-item:last-child { margin-bottom: 0; }

        .alternative-text {
            font-size: 0.85rem;
            color: var(--white);
            flex: 1;
        }

        .use-this-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--gold);
            border-radius: 6px;
            color: var(--gold);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            flex-shrink: 0;
            margin-left: 12px;
        }

        .use-this-btn:hover {
            background: var(--gold);
            color: var(--black);
        }

        /* Improvement Tips */
        .improvement-tips {
            display: none;
            padding: 20px;
            background: rgba(40, 202, 65, 0.05);
            border: 1px solid rgba(40, 202, 65, 0.15);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .improvement-tips.visible { display: block; }

        .improvement-tips-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .improvement-tips-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--success);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .tips-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .tip-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--gray-light);
            line-height: 1.5;
        }

        .tip-bullet {
            color: var(--success);
            font-weight: 600;
        }

        /* Confidence Score */
        .confidence-score {
            display: none;
            text-align: right;
            margin-bottom: 16px;
        }

        .confidence-score.visible { display: block; }

        .confidence-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-right: 8px;
        }

        .confidence-value {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .confidence-value.high { color: var(--success); }
        .confidence-value.medium { color: #ffbd2e; }
        .confidence-value.low { color: var(--error); }

        /* Thread Output Display */
        .thread-output {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .thread-output.fade-in {
            animation: fadeInContent 0.25s ease-out;
        }

        .thread-tweet {
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .thread-tweet:last-child { margin-bottom: 0; }

        .thread-tweet-number {
            color: var(--gold);
            font-weight: 600;
            margin-right: 8px;
        }

        /* ============ RESPONSIVE ============ */
        @media (max-width: 768px) {
            .tool-grid {
                grid-template-columns: 1fr;
            }
            .tool-panel {
                padding: 20px;
            }
            .text-area {
                min-height: 200px;
            }
            header {
                padding: 16px 0;
            }
            .header-inner {
                padding: 0 16px;
            }
            .logo-img {
                height: 140px;
            }
            nav {
                display: none;
            }
            .hamburger {
                display: flex;
            }
            .mobile-nav {
                display: flex;
            }
            .container {
                padding: 24px 16px 60px;
            }
            .page-title {
                font-size: 1.5rem;
                gap: 10px;
            }
            .page-title svg {
                width: 24px;
                height: 24px;
            }
            .page-subtitle {
                font-size: 0.9rem;
                margin-bottom: 24px;
            }
            .card {
                padding: 16px;
            }
            textarea {
                min-height: 160px;
                font-size: 0.85rem;
            }
            .btn {
                padding: 12px 16px;
                font-size: 0.85rem;
            }
            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            .results-title {
                font-size: 0.85rem;
            }
            .tweet-content {
                font-size: 0.85rem;
                padding: 14px;
            }
            .tweet-header,
            .tweet-footer {
                padding: 10px 14px;
            }
        }

        @media (max-width: 480px) {
            .logo-img {
                height: 120px;
            }
            .page-title {
                font-size: 1.3rem;
            }
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            .card-header > div {
                width: 100%;
                justify-content: space-between;
            }
            .btn.secondary {
                padding: 10px 14px;
                font-size: 0.8rem;
            }
            .tweet-content {
                font-size: 0.8rem;
            }
            .copy-tweet-btn {
                font-size: 0.7rem;
                padding: 6px 10px;
            }
        }

        /* Feedback Section */
        .feedback-section {
            max-width: 1000px;
            margin: 0 auto;
            padding: 60px 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .feedback-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .feedback-subtitle {
            font-size: 0.95rem;
            color: #888;
            margin-bottom: 24px;
        }

        .feedback-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .feedback-textarea {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            resize: vertical;
            transition: border-color 0.2s ease;
        }

        .feedback-textarea:focus {
            outline: none;
            border-color: var(--gold);
        }

        .feedback-textarea::placeholder {
            color: #666;
        }

        .feedback-submit {
            align-self: flex-start;
            padding: 12px 28px;
            background: var(--gold);
            color: var(--black);
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .feedback-submit:hover {
            background: var(--gold-light);
            transform: translateY(-1px);
        }

        .feedback-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .feedback-success {
            display: none;
            padding: 16px 20px;
            background: rgba(40, 202, 65, 0.1);
            border: 1px solid rgba(40, 202, 65, 0.3);
            border-radius: 10px;
            color: #28ca41;
            font-size: 0.95rem;
        }

        .feedback-success.visible {
            display: block;
        }

        .feedback-error {
            display: none;
            padding: 16px 20px;
            background: rgba(255, 95, 87, 0.1);
            border: 1px solid rgba(255, 95, 87, 0.3);
            border-radius: 10px;
            color: #ff5f57;
            font-size: 0.95rem;
        }

        .feedback-error.visible {
            display: block;
        }

        /* Pricing Banner */
        .pricing-banner {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.15) 0%, rgba(201, 162, 39, 0.05) 100%);
            border: 1px solid rgba(201, 162, 39, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }

        .pricing-banner-text {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .pricing-banner-price {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gold);
        }

        .pricing-banner-desc {
            font-size: 0.9rem;
            color: var(--gray-light);
        }

        .pricing-banner-free {
            font-size: 0.85rem;
            color: var(--gray);
            background: rgba(255, 255, 255, 0.05);
            padding: 6px 12px;
            border-radius: 20px;
        }

        .pricing-banner .btn-subscribe {
            background: var(--gold);
            color: var(--black);
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .pricing-banner .btn-subscribe:hover {
            background: var(--gold-light);
            transform: translateY(-1px);
        }

        @media (max-width: 480px) {
            .pricing-banner {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
            }
            .pricing-banner .btn-subscribe {
                width: 100%;
                text-align: center;
            }
        }

        /* Tool Section Header */
        .tool-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .tool-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-section-title svg {
            color: var(--gold);
        }

        /* Larger Tool Card */
        .card.tool-card {
            background: var(--bg-card);
            border: 2px solid rgba(201, 162, 39, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .card.tool-card textarea {
            min-height: 240px;
            font-size: 0.95rem;
        }

        /* Bottom CTA */
        .bottom-cta {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.1) 0%, rgba(201, 162, 39, 0.02) 100%);
            border: 1px solid rgba(201, 162, 39, 0.2);
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            margin-top: 40px;
        }

        .bottom-cta-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .bottom-cta-subtitle {
            font-size: 0.95rem;
            color: var(--gray);
            margin-bottom: 20px;
        }

        .bottom-cta .btn-subscribe {
            background: var(--gold);
            color: var(--black);
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s ease;
        }

        .bottom-cta .btn-subscribe:hover {
            background: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(201, 162, 39, 0.3);
        }

        /* Subscribed button state */
        .btn-subscribed {
            background: #2d5a3d !important;
            color: #fff !important;
            cursor: default !important;
        }

        .btn-subscribed:hover {
            background: #2d5a3d !important;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Checkout Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            max-width: 400px;
            width: 100%;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 4px;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: var(--white);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
        }

        .modal-subtitle {
            font-size: 0.9rem;
            color: var(--gray);
            text-align: center;
            margin-bottom: 24px;
        }

        .modal-price-tag {
            background: var(--gold-dim);
            border: 1px solid rgba(201, 162, 39, 0.3);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            margin-bottom: 24px;
        }

        .modal-price-tag .tool-name {
            font-size: 0.85rem;
            color: var(--gray-light);
            margin-bottom: 4px;
        }

        .modal-price-tag .price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gold);
        }

        .modal-input {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px 16px;
            color: var(--white);
            font-size: 0.95rem;
            font-family: inherit;
            margin-bottom: 16px;
            transition: border-color 0.2s ease;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .modal-input::placeholder {
            color: #555;
        }

        .modal-btn {
            width: 100%;
            background: var(--gold);
            color: var(--black);
            border: none;
            border-radius: 8px;
            padding: 14px 20px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .modal-btn:hover:not(:disabled) {
            background: var(--gold-light);
            transform: translateY(-1px);
        }

        .modal-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .modal-error {
            background: rgba(255, 95, 87, 0.1);
            border: 1px solid rgba(255, 95, 87, 0.3);
            color: var(--error);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 16px;
            display: none;
        }

        .modal-error.visible {
            display: block;
        }

        /* ============ STEP INDICATOR ============ */
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 24px;
            gap: 8px;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            opacity: 0.4;
            transition: opacity 0.2s ease;
        }

        .step.active,
        .step.completed {
            opacity: 1;
        }

        .step-number {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-dark);
            border-radius: 50%;
            font-size: 12px;
            font-weight: 600;
        }

        .step.active .step-number {
            background: var(--gold);
            color: var(--black);
        }

        .step.completed .step-number {
            background: var(--success);
            color: white;
        }

        .step-label {
            font-size: 11px;
            color: var(--gray);
        }

        .step.active .step-label {
            color: var(--gold);
        }

        .step-divider {
            width: 24px;
            height: 2px;
            background: var(--gray-dark);
            margin-bottom: 18px;
        }

        /* ============ TONE SELECTOR ============ */
        .tone-selector {
            margin-top: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .tone-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .tone-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tone-option {
            cursor: pointer;
        }

        .tone-option input {
            display: none;
        }

        .tone-btn {
            display: inline-block;
            padding: 8px 14px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--gray-light);
            transition: all 0.2s ease;
        }

        .tone-option:hover .tone-btn {
            border-color: var(--gray);
        }

        .tone-option input:checked + .tone-btn {
            background: var(--gold-dim);
            border-color: var(--gold);
            color: var(--gold);
        }

        @media (max-width: 480px) {
            .tone-options {
                flex-direction: column;
            }
            .tone-btn {
                display: block;
                text-align: center;
            }
        }

        /* ============ FORMATTING OPTIONS ============ */
        .formatting-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 16px;
        }

        .toggle-option {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            user-select: none;
        }

        .toggle-option input[type="checkbox"] {
            display: none;
        }

        .toggle-slider {
            width: 40px;
            height: 22px;
            background: var(--gray-dark);
            border-radius: 11px;
            position: relative;
            transition: background 0.2s ease;
            flex-shrink: 0;
        }

        .toggle-slider::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: var(--gray);
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.2s ease, background 0.2s ease;
        }

        .toggle-option input:checked + .toggle-slider {
            background: var(--gold);
        }

        .toggle-option input:checked + .toggle-slider::after {
            transform: translateX(18px);
            background: var(--black);
        }

        .toggle-label {
            font-size: 0.85rem;
            color: var(--gray-light);
        }

        /* ============ TOO SHORT WARNING ============ */
        .too-short-warning {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 20px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .too-short-warning.hidden {
            display: none;
        }

        .warning-icon {
            color: #ffc107;
        }

        .warning-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--white);
        }

        .warning-text {
            font-size: 0.9rem;
            color: var(--gray-light);
        }

        .warning-actions {
            display: flex;
            gap: 12px;
        }

        .warning-btn {
            flex: 1;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .warning-btn.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--white);
        }

        .warning-btn.secondary:hover {
            background: var(--gray-dark);
        }

        .warning-btn.primary {
            background: var(--gold);
            border: none;
            color: var(--black);
        }

        .warning-btn.primary:hover {
            background: var(--gold-light);
        }

        /* ============ SELECTION VIEWS ============ */
        .selection-view {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .selection-view.hidden {
            display: none;
        }

        .selection-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .selection-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .selection-subtitle {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .hook-options,
        .cta-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .hook-option,
        .cta-option {
            padding: 16px;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .hook-option:hover,
        .cta-option:hover {
            border-color: var(--gray);
        }

        .hook-option.selected,
        .cta-option.selected {
            border-color: var(--gold);
            background: var(--gold-dim);
        }

        .option-type {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 8px;
        }

        .option-content {
            font-size: 0.95rem;
            color: var(--white);
            line-height: 1.5;
        }

        .option-char-count {
            font-size: 0.75rem;
            color: var(--gray);
            text-align: right;
            margin-top: 10px;
        }

        .selection-actions {
            display: flex;
            gap: 12px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .selection-actions .btn.secondary {
            flex-shrink: 0;
        }

        .selection-actions .btn.primary {
            flex: 1;
        }

        .selection-actions .btn.primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ============ CUSTOM CTA SECTION ============ */
        .custom-cta-section {
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .custom-cta-section textarea {
            margin-top: 12px;
            width: 100%;
            min-height: 80px;
        }

        .custom-cta-section textarea.hidden {
            display: none;
        }

        .custom-cta-char-count {
            font-size: 0.75rem;
            color: var(--gray);
            text-align: right;
            margin-top: 6px;
        }

        .custom-cta-char-count.hidden {
            display: none;
        }

        /* ============ GENERATION VIEW ============ */
        .generation-view {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 60px 24px;
            margin-bottom: 24px;
            text-align: center;
        }

        .generation-view.hidden {
            display: none;
        }

        .generation-status {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .spinner.large {
            width: 40px;
            height: 40px;
            border-width: 4px;
        }

        .generation-status h3 {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .generation-subtitle {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* ============ RESULTS ACTIONS ============ */
        .results-actions {
            display: flex;
            gap: 10px;
        }

        /* ============ HIDDEN UTILITY ============ */
        .hidden {
            display: none !important;
        }

        /* ============ RESPONSIVE FOR NEW COMPONENTS ============ */
        @media (max-width: 600px) {
            .step-indicator {
                padding: 16px 12px;
                gap: 4px;
            }

            .step-number {
                width: 24px;
                height: 24px;
                font-size: 11px;
            }

            .step-label {
                font-size: 10px;
            }

            .step-divider {
                width: 16px;
            }

            .warning-actions {
                flex-direction: column;
            }

            .selection-actions {
                flex-direction: column;
            }

            .selection-actions .btn.secondary {
                order: 2;
            }

            .selection-actions .btn.primary {
                order: 1;
            }

            .results-actions {
                flex-direction: column;
                width: 100%;
            }

            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <header id="header">
        <div class="header-inner">
            <a href="/" class="logo"><img src="logo.png" alt="LTG Vault" class="logo-img"></a>
            <nav>
                <a href="postup.html">PostUp</a>
                <a href="threadgen.html" class="active">ThreadGen</a>
                <a href="chaptergen.html">ChapterGen</a>
                <a href="pricing.html">Pricing</a>
                <a href="dashboard.html">Dashboard</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
            ThreadGen
        </h1>
        <p class="page-subtitle">Transform your content into engaging X/Twitter threads.</p>

        <!-- Pricing Banner -->
        <div class="pricing-banner" id="pricingBanner">
            <div class="pricing-banner-text">
                <span class="pricing-banner-price">$7/month</span>
                <span class="pricing-banner-desc">Unlimited threads</span>
                <span class="pricing-banner-free" id="freeUsesText">3 free uses to start</span>
            </div>
            <button class="btn-subscribe" onclick="openCheckoutModal()">Subscribe</button>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator" id="stepIndicator">
            <div class="step active" data-step="1">
                <span class="step-number">1</span>
                <span class="step-label">Input</span>
            </div>
            <div class="step-divider"></div>
            <div class="step" data-step="2">
                <span class="step-number">2</span>
                <span class="step-label">Hook</span>
            </div>
            <div class="step-divider"></div>
            <div class="step" data-step="3">
                <span class="step-number">3</span>
                <span class="step-label">Body</span>
            </div>
            <div class="step-divider"></div>
            <div class="step" data-step="4">
                <span class="step-number">4</span>
                <span class="step-label">CTA</span>
            </div>
            <div class="step-divider"></div>
            <div class="step" data-step="5">
                <span class="step-number">5</span>
                <span class="step-label">Done</span>
            </div>
        </div>

        <!-- Before/After Section -->
        <div class="before-after">
            <p class="before-after-title">See the difference</p>
            <div class="before-after-grid">
                <div class="before-box">
                    <div class="box-label">Your content</div>
                    <div class="box-content">I've been building in public for 6 months. Here's what I learned: consistency beats perfection, share your failures, engage with your audience daily, and don't be afraid to pivot when something isn't working.</div>
                </div>
                <div class="before-after-arrow"></div>
                <div class="after-box">
                    <div class="box-label">ThreadGen output</div>
                    <div class="box-content">
                        <div class="thread-tweet"><div class="thread-num">1/5</div>I've been building in public for 6 months. Here's what actually worked (and what didn't):</div>
                        <div class="thread-tweet"><div class="thread-num">2/5</div>Consistency beats perfection. I shipped something every week, even when it wasn't perfect.</div>
                        <div class="thread-tweet"><div class="thread-num">3/5</div>Share your failures. My biggest flops got 10x more engagement than wins.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Animated Demo Section -->
        <div class="demo-section">
            <p class="demo-title">Watch it in action</p>
            <div class="demo-tool-grid">
                <!-- Input Panel -->
                <div class="demo-tool-panel">
                    <div class="demo-panel-header">
                        <span class="demo-panel-label">Your Content</span>
                        <span class="demo-char-count" id="demoInputCount">0 chars</span>
                    </div>
                    <div class="demo-text-area input-area" id="demoInput"></div>
                    <div class="demo-button-row">
                        <button class="demo-generate-btn" id="demoButton">
                            <span class="demo-spinner"></span>
                            <span class="demo-btn-text">Generate Thread</span>
                        </button>
                    </div>
                </div>
                <!-- Output Panel -->
                <div class="demo-tool-panel">
                    <div class="demo-panel-header">
                        <span class="demo-panel-label">Your Thread</span>
                        <span class="demo-char-count" id="demoOutputCount">0 tweets</span>
                    </div>
                    <div class="demo-text-area output-area" id="demoOutput"></div>
                </div>
            </div>
        </div>

        <!-- Status -->
        <div id="status" class="status"></div>

        <!-- Too Short Warning -->
        <div class="too-short-warning hidden" id="tooShortWarning">
            <div class="warning-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
            </div>
            <div class="warning-content">
                <p class="warning-title">Content seems short for a thread</p>
                <p class="warning-text">This might work better as a single tweet or needs more content.</p>
            </div>
            <div class="warning-actions">
                <button class="warning-btn secondary" id="useSingleTweetBtn">Use as Single Tweet</button>
                <button class="warning-btn primary" id="continueAnywayBtn">Continue Anyway</button>
            </div>
        </div>

        <!-- Hook Selection View -->
        <div class="selection-view hidden" id="hookSelectionView">
            <div class="selection-header">
                <h2>Choose Your Hook</h2>
                <p class="selection-subtitle">Select the opening that best fits your content</p>
            </div>
            <div class="hook-options" id="hookOptions">
                <!-- Dynamically populated -->
            </div>
            <div class="selection-actions">
                <button class="btn secondary" id="backToInputBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"></path>
                    </svg>
                    Back
                </button>
                <button class="btn primary" id="confirmHookBtn" disabled>Continue with Selected Hook</button>
            </div>
        </div>

        <!-- Body Generation View -->
        <div class="generation-view hidden" id="bodyGenerationView">
            <div class="generation-status">
                <div class="spinner large"></div>
                <h3>Generating Thread Body</h3>
                <p class="generation-subtitle">Creating tweets based on your selected hook...</p>
            </div>
        </div>

        <!-- CTA Selection View -->
        <div class="selection-view hidden" id="ctaSelectionView">
            <div class="selection-header">
                <h2>Choose Your Closing</h2>
                <p class="selection-subtitle">How do you want to end your thread?</p>
            </div>
            <div class="cta-options" id="ctaOptions">
                <!-- Dynamically populated -->
            </div>
            <div class="custom-cta-section">
                <label class="toggle-option">
                    <input type="checkbox" id="useCustomCta">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Write custom CTA instead</span>
                </label>
                <textarea id="customCtaInput" class="hidden" placeholder="Write your own closing tweet..." rows="3" maxlength="280"></textarea>
                <div class="custom-cta-char-count hidden" id="customCtaCharCount">0/280</div>
            </div>
            <div class="selection-actions">
                <button class="btn secondary" id="backToHookBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"></path>
                    </svg>
                    Back
                </button>
                <button class="btn primary" id="confirmCtaBtn" disabled>Complete Thread</button>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel">
            <div class="settings-content">
                <h2 class="settings-title">API Settings</h2>
                <div class="input-group">
                    <label>API Key</label>
                    <div class="input-wrapper">
                        <input type="password" id="apiKey" placeholder="ltgv_..." autocomplete="off">
                        <button id="toggleKey" class="icon-btn" title="Toggle visibility">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <button id="saveKey" class="btn primary">Save API Key</button>
                <p class="hint">
                    <a href="/dashboard.html">Get your API key from the dashboard</a><br>
                    Your key is stored locally and never shared.
                </p>
                <div id="usageInfo" style="margin-top: 12px; font-size: 0.85rem; color: #888; display: none;"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent">
            <!-- Tool Grid: Two Columns -->
            <div class="tool-grid">
                <!-- Left Panel: Input -->
                <div class="tool-panel">
                    <div class="panel-header">
                        <span class="panel-label">Your Content</span>
                        <span class="char-count" id="inputCount">0 chars</span>
                    </div>
                    <textarea class="text-area" id="inputText" placeholder="Paste your blog post, article, or notes here...

The AI will transform your content into an engaging Twitter thread."></textarea>

                    <!-- Formatting Options -->
                    <div class="formatting-options" style="margin-top: 16px;">
                        <label class="toggle-option">
                            <input type="checkbox" id="tweetNumbering" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Tweet numbering (1/, 2/...)</span>
                        </label>
                        <label class="toggle-option">
                            <input type="checkbox" id="emojiUsage">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Allow emojis</span>
                        </label>
                    </div>

                    <!-- Tone Selector -->
                    <div class="tone-selector" style="margin-top: 16px;">
                        <label class="tone-label">Thread Tone</label>
                        <div class="tone-options">
                            <label class="tone-option">
                                <input type="radio" name="tone" value="educational" checked>
                                <span class="tone-btn">Educational</span>
                            </label>
                            <label class="tone-option">
                                <input type="radio" name="tone" value="spicy">
                                <span class="tone-btn">Spicy</span>
                            </label>
                            <label class="tone-option">
                                <input type="radio" name="tone" value="story">
                                <span class="tone-btn">Story</span>
                            </label>
                            <label class="tone-option">
                                <input type="radio" name="tone" value="opinionated">
                                <span class="tone-btn">Opinionated</span>
                            </label>
                        </div>
                    </div>

                    <!-- Usage Counter -->
                    <div id="usageCounter" class="usage-counter" style="margin-top: 16px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                        </svg>
                        <span id="usageText"><span class="count">3</span> <span class="label">free uses left</span></span>
                    </div>

                    <div class="button-row">
                        <button class="generate-btn" id="generateBtn">
                            <span class="btn-text">Generate Thread</span>
                            <span class="btn-loading-text">Generating...</span>
                            <div class="spinner"></div>
                        </button>
                    </div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <!-- Right Panel: Output -->
                <div class="tool-panel">
                    <div class="panel-header">
                        <span class="panel-label">Generated Thread</span>
                        <span class="char-count" id="outputCount">0 tweets</span>
                    </div>
                    <div class="thread-output" id="threadOutput">
                        <div style="text-align: center; color: #555; padding: 40px 20px;">
                            Your thread will appear here...
                        </div>
                    </div>

                    <div class="button-row">
                        <button class="copy-btn" id="copyBtn" disabled>
                            <svg class="copy-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            <svg class="check-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            <span id="copyText">Copy Thread</span>
                        </button>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions" id="quickActions">
                        <button class="quick-action-btn" data-action="stronger_hook">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                            </svg>
                            Stronger Hook
                        </button>
                        <button class="quick-action-btn" data-action="add_tweet">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                            Add Tweet
                        </button>
                        <button class="quick-action-btn" data-action="sharper_cta">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            Sharper CTA
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading (shows during generation) -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p id="loadingText">Creating your thread...</p>
            </div>

            <!-- Alternative Hooks -->
            <div class="alternatives-section" id="alternativesSection">
                <div class="alternatives-title">Alternative Hooks</div>
                <div class="alternatives-list" id="alternativesList"></div>
            </div>

            <!-- Improvement Tips -->
            <div class="improvement-tips" id="improvementTips">
                <div class="improvement-tips-header">
                    <div class="improvement-tips-title">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                        </svg>
                        Improvement Tips
                    </div>
                </div>
                <div class="tips-list" id="tipsList"></div>
            </div>

            <!-- Confidence Score -->
            <div class="confidence-score" id="confidenceScore">
                <span class="confidence-label">Thread Score:</span>
                <span class="confidence-value" id="confidenceValue">--/100</span>
            </div>

            <!-- Settings Button (floating) -->
            <button id="settingsBtn" class="icon-btn" title="API Settings" style="position: fixed; bottom: 20px; right: 20px; background: var(--bg-card); border: 1px solid var(--border); padding: 12px; border-radius: 50%; z-index: 100;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
                </svg>
            </button>

            <!-- Bottom CTA -->
            <div class="bottom-cta" id="bottomCta">
                <h3 class="bottom-cta-title">Get unlimited access</h3>
                <p class="bottom-cta-subtitle">Generate unlimited threads for just $7/month</p>
                <button class="btn-subscribe" onclick="openCheckoutModal()">Subscribe Now</button>
            </div>
        </div>
    </main>

    <!-- Feedback Section -->
    <section class="feedback-section">
        <h2 class="feedback-title">Help me improve this tool</h2>
        <p class="feedback-subtitle">Got ideas, bugs, or feedback? I'd love to hear from you.</p>
        <form class="feedback-form" id="feedbackForm">
            <input type="hidden" name="tool" value="ThreadGen">
            <textarea class="feedback-textarea" name="message" id="feedbackText" placeholder="What's on your mind?" required></textarea>
            <button type="submit" class="feedback-submit" id="feedbackSubmit">Submit Feedback</button>
        </form>
        <div class="feedback-success" id="feedbackSuccess">Thanks for your feedback! I really appreciate it.</div>
        <div class="feedback-error" id="feedbackError">Something went wrong. Please try again.</div>
    </section>

    <footer>
        <div class="footer-inner">
            <p class="footer-text">Built by LTG</p>
        </div>
    </footer>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeCheckoutModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
            <h2 class="modal-title">Subscribe to ThreadGen</h2>
            <p class="modal-subtitle">Unlimited threads, cancel anytime</p>
            <div class="modal-price-tag">
                <div class="tool-name">ThreadGen</div>
                <div class="price">$7/month</div>
            </div>
            <div class="modal-error" id="checkoutError"></div>
            <input type="email" class="modal-input" id="checkoutEmail" placeholder="Enter your email" autocomplete="email">
            <button class="modal-btn" id="checkoutBtn" onclick="startCheckout()">Continue to Checkout</button>
        </div>
    </div>

    <script>
        // Checkout Modal Functions
        function openCheckoutModal() {
            document.getElementById('checkoutModal').classList.add('visible');
            document.getElementById('checkoutEmail').focus();
        }

        function closeCheckoutModal() {
            document.getElementById('checkoutModal').classList.remove('visible');
            document.getElementById('checkoutError').classList.remove('visible');
            document.getElementById('checkoutEmail').value = '';
        }

        // Close modal on overlay click
        document.getElementById('checkoutModal').addEventListener('click', function(e) {
            if (e.target === this) closeCheckoutModal();
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeCheckoutModal();
        });

        async function startCheckout() {
            var email = document.getElementById('checkoutEmail').value.trim();
            var errorEl = document.getElementById('checkoutError');
            var btn = document.getElementById('checkoutBtn');

            // Validate email
            if (!email) {
                errorEl.textContent = 'Please enter your email address';
                errorEl.classList.add('visible');
                return;
            }

            var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                errorEl.textContent = 'Please enter a valid email address';
                errorEl.classList.add('visible');
                return;
            }

            errorEl.classList.remove('visible');
            btn.disabled = true;
            btn.textContent = 'Redirecting...';

            try {
                var response = await fetch('/api/checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email, tool: 'threadgen' })
                });

                var data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to create checkout session');
                }

                if (data.url) {
                    window.location.href = data.url;
                } else {
                    throw new Error('No checkout URL returned');
                }
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.classList.add('visible');
                btn.disabled = false;
                btn.textContent = 'Continue to Checkout';
            }
        }

        // Handle Enter key in email input
        document.getElementById('checkoutEmail').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') startCheckout();
        });
    </script>

    <script>
        // ============ FREE TRIAL SYSTEM ============
        var FREE_TRIAL_LIMIT = 3;
        var FREE_TRIAL_KEY = 'threadgen_free_uses';

        function getFreeTrialUses() {
            var uses = localStorage.getItem(FREE_TRIAL_KEY);
            if (uses === null) {
                localStorage.setItem(FREE_TRIAL_KEY, FREE_TRIAL_LIMIT);
                return FREE_TRIAL_LIMIT;
            }
            var parsedUses = parseInt(uses, 10);
            // Cap at limit (in case limit was reduced)
            if (parsedUses > FREE_TRIAL_LIMIT) {
                localStorage.setItem(FREE_TRIAL_KEY, FREE_TRIAL_LIMIT);
                return FREE_TRIAL_LIMIT;
            }
            return parsedUses;
        }

        function decrementFreeTrial() {
            console.log('=== DECREMENT FREE TRIAL ===');
            console.log('BEFORE decrement:', localStorage.getItem(FREE_TRIAL_KEY));
            var uses = getFreeTrialUses();
            console.log('getFreeTrialUses returned:', uses);
            if (uses > 0) {
                localStorage.setItem(FREE_TRIAL_KEY, uses - 1);
                console.log('AFTER decrement:', localStorage.getItem(FREE_TRIAL_KEY));
            } else {
                console.log('No uses left to decrement');
            }
            return uses - 1;
        }

        function updateFreeTrialUI(isSubscribed) {
            var ltgvKey = localStorage.getItem('ltgv_api_key');
            var freeUsesText = document.getElementById('freeUsesText');
            var usageCounter = document.getElementById('usageCounter');
            var usageText = document.getElementById('usageText');
            var generateBtn = document.getElementById('generateBtn');
            var settingsPanel = document.getElementById('settingsPanel');

            // If user is subscribed, show unlimited and hide settings panel
            if (isSubscribed) {
                if (usageCounter) {
                    usageCounter.className = 'usage-counter unlimited';
                    usageText.innerHTML = '<span class="count">Unlimited</span> <span class="label">uses</span>';
                }
                if (freeUsesText) freeUsesText.style.display = 'none';
                if (settingsPanel) settingsPanel.style.display = 'none';
                if (generateBtn) generateBtn.disabled = false;
                return;
            }

            // Show settings panel for non-subscribed users
            if (settingsPanel) settingsPanel.style.display = 'block';

            // If user has API key but not subscribed
            if (ltgvKey) {
                if (freeUsesText) freeUsesText.style.display = 'none';
                return;
            }

            // Free trial user - show remaining uses
            var uses = getFreeTrialUses();

            // Update visual counter
            if (usageCounter && usageText) {
                if (uses > 0) {
                    usageCounter.className = 'usage-counter';
                    usageText.innerHTML = '<span class="count">' + uses + '</span> <span class="label">free ' + (uses === 1 ? 'use' : 'uses') + ' left</span>';
                    if (generateBtn) generateBtn.disabled = false;
                } else {
                    usageCounter.className = 'usage-counter exhausted';
                    usageText.innerHTML = '<span class="count">0</span> <span class="label">uses left</span>  <a href="/pricing.html">Get unlimited</a>';
                    if (generateBtn) generateBtn.disabled = true;
                }
            }

            // Update old banner text
            if (freeUsesText) {
                if (uses > 0) {
                    freeUsesText.textContent = uses + ' free ' + (uses === 1 ? 'use' : 'uses') + ' remaining';
                    freeUsesText.style.display = 'inline-block';
                } else {
                    freeUsesText.textContent = 'Free trial ended';
                    freeUsesText.style.display = 'inline-block';
                }
            }
        }

        // DOM Elements
        var elements = {
            settingsBtn: document.getElementById('settingsBtn'),
            settingsPanel: document.getElementById('settingsPanel'),
            apiKeyInput: document.getElementById('apiKey'),
            toggleKeyBtn: document.getElementById('toggleKey'),
            saveKeyBtn: document.getElementById('saveKey'),
            mainContent: document.getElementById('mainContent'),
            status: document.getElementById('status'),
            inputText: document.getElementById('inputText'),
            inputCount: document.getElementById('inputCount'),
            outputCount: document.getElementById('outputCount'),
            generateBtn: document.getElementById('generateBtn'),
            loading: document.getElementById('loading'),
            loadingText: document.getElementById('loadingText'),
            threadOutput: document.getElementById('threadOutput'),
            copyBtn: document.getElementById('copyBtn'),
            copyText: document.getElementById('copyText'),
            quickActions: document.getElementById('quickActions'),
            alternativesSection: document.getElementById('alternativesSection'),
            alternativesList: document.getElementById('alternativesList'),
            improvementTips: document.getElementById('improvementTips'),
            tipsList: document.getElementById('tipsList'),
            confidenceScore: document.getElementById('confidenceScore'),
            confidenceValue: document.getElementById('confidenceValue'),
            errorMessage: document.getElementById('errorMessage')
        };

        // State
        var currentThread = [];
        var generatedThread = '';

        // Simplified state
        var state = {
            originalContent: '',
            thread: [],
            apiKeyValid: false,
            isSubscribed: false,
            settings: {
                tweetNumbering: true,
                emojiUsage: false,
                tone: 'educational'
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadApiKey();
            loadFormattingSettings();
            setupEventListeners();
            updateFreeTrialUI();
            prefillExampleText();
            startDemoAnimation();
        });

        // Pre-fill example text for first-time users
        function prefillExampleText() {
            var EXAMPLE_KEY = 'threadgen_has_generated';
            if (localStorage.getItem(EXAMPLE_KEY)) return;

            var exampleText = "Hot take: Most productivity advice is written by people who've never actually built anything. They optimize for looking busy, not getting results. The best productivity system is the one you'll actually use, even if it's just a sticky note.";

            elements.inputText.value = exampleText;
            updateInputCount();
        }

        function markAsGenerated() {
            localStorage.setItem('threadgen_has_generated', 'true');
        }

        // Animated Demo
        function startDemoAnimation() {
            var demoInput = document.getElementById('demoInput');
            var demoOutput = document.getElementById('demoOutput');
            var demoButton = document.getElementById('demoButton');
            var demoInputCount = document.getElementById('demoInputCount');
            var demoOutputCount = document.getElementById('demoOutputCount');

            if (!demoInput || !demoOutput || !demoButton) return;

            var inputText = "The best productivity hack nobody talks about: strategic quitting. Here's what I learned after burning out twice.";
            var outputTweets = [
                "1/ The best productivity advice I ever got had nothing to do with waking up at 5am.\n\nIt was learning when to quit.\n\nHere's what burning out twice taught me:",
                "2/ We glorify hustle.\nWe shame rest.\n\nBut your brain doesn't work like a machine.\nIt works like a muscle.\n\nPush too hard, too long = injury.",
                "3/ Strategic quitting isn't giving up.\n\nIt's recognizing:\n Diminishing returns\n When rest beats grind\n That tomorrow-you needs energy too",
                "4/ If this hit different, you probably needed to hear it.\n\nFollow for more no-BS productivity takes.\n\nNow go take that break."
            ];

            function runAnimation() {
                // Reset
                demoInput.innerHTML = '<span class="cursor"></span>';
                demoOutput.innerHTML = '';
                demoButton.classList.remove('ready', 'active', 'clicked', 'loading');
                if (demoInputCount) demoInputCount.textContent = '0 chars';
                if (demoOutputCount) demoOutputCount.textContent = '0 tweets';

                var inputIndex = 0;
                var tweetIndex = 0;
                var charIndex = 0;

                // Phase 1: Type input
                function typeInput() {
                    if (inputIndex < inputText.length) {
                        demoInput.innerHTML = inputText.substring(0, inputIndex + 1) + '<span class="cursor"></span>';
                        if (demoInputCount) demoInputCount.textContent = (inputIndex + 1) + ' chars';
                        inputIndex++;
                        setTimeout(typeInput, 25);
                    } else {
                        demoInput.innerHTML = inputText;
                        demoButton.classList.add('ready');
                        setTimeout(clickButton, 400);
                    }
                }

                // Phase 2: Click button with loading state
                function clickButton() {
                    demoButton.classList.add('active');
                    setTimeout(function() {
                        demoButton.classList.add('clicked');
                        setTimeout(function() {
                            demoButton.classList.remove('clicked');
                            demoButton.classList.add('loading');
                            setTimeout(typeThread, 600);
                        }, 100);
                    }, 200);
                }

                // Phase 3: Type thread tweets
                function typeThread() {
                    demoButton.classList.remove('loading');
                    if (tweetIndex < outputTweets.length) {
                        var currentTweet = outputTweets[tweetIndex];
                        if (charIndex < currentTweet.length) {
                            // Build all completed tweets + current partial tweet
                            var html = '';
                            for (var i = 0; i < tweetIndex; i++) {
                                html += '<div class="demo-tweet">' + outputTweets[i].replace(/\n/g, '<br>') + '</div>';
                            }
                            html += '<div class="demo-tweet">' + currentTweet.substring(0, charIndex + 1).replace(/\n/g, '<br>') + '</div>';
                            demoOutput.innerHTML = html;
                            if (demoOutputCount) demoOutputCount.textContent = (tweetIndex + 1) + ' tweets';
                            charIndex++;
                            setTimeout(typeThread, 10);
                        } else {
                            tweetIndex++;
                            charIndex = 0;
                            setTimeout(typeThread, 150);
                        }
                    } else {
                        // Pause then restart
                        setTimeout(runAnimation, 3500);
                    }
                }

                setTimeout(typeInput, 600);
            }

            runAnimation();
        }

        function setupEventListeners() {
            elements.settingsBtn.addEventListener('click', toggleSettings);
            elements.toggleKeyBtn.addEventListener('click', toggleKeyVisibility);
            elements.saveKeyBtn.addEventListener('click', saveApiKey);
            elements.inputText.addEventListener('input', updateInputCount);
            elements.generateBtn.addEventListener('click', startGeneration);
            elements.copyBtn.addEventListener('click', copyThread);

            // Quick action buttons
            var quickBtns = document.querySelectorAll('.quick-action-btn');
            quickBtns.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var action = btn.getAttribute('data-action');
                    handleQuickAction(action);
                });
            });

            // Formatting toggles
            var numberingToggle = document.getElementById('tweetNumbering');
            var emojiToggle = document.getElementById('emojiUsage');
            if (numberingToggle) {
                numberingToggle.addEventListener('change', function(e) {
                    state.settings.tweetNumbering = e.target.checked;
                    localStorage.setItem('threadgen_numbering', e.target.checked);
                });
            }
            if (emojiToggle) {
                emojiToggle.addEventListener('change', function(e) {
                    state.settings.emojiUsage = e.target.checked;
                    localStorage.setItem('threadgen_emoji', e.target.checked);
                });
            }

            // Tone selector
            var toneRadios = document.querySelectorAll('input[name="tone"]');
            toneRadios.forEach(function(radio) {
                radio.addEventListener('change', function(e) {
                    state.settings.tone = e.target.value;
                    localStorage.setItem('threadgen_tone', e.target.value);
                });
            });

            // Too short warning buttons
            var useSingleBtn = document.getElementById('useSingleTweetBtn');
            var continueAnywayBtn = document.getElementById('continueAnywayBtn');
            if (useSingleBtn) useSingleBtn.addEventListener('click', useSingleTweet);
            if (continueAnywayBtn) continueAnywayBtn.addEventListener('click', function() { proceedWithGeneration(true); });

            // Hook selection
            var confirmHookBtn = document.getElementById('confirmHookBtn');
            var backToInputBtn = document.getElementById('backToInputBtn');
            if (confirmHookBtn) confirmHookBtn.addEventListener('click', continueWithHook);
            if (backToInputBtn) backToInputBtn.addEventListener('click', function() { setStep(1); });

            // CTA selection
            var confirmCtaBtn = document.getElementById('confirmCtaBtn');
            var backToHookBtn = document.getElementById('backToHookBtn');
            var useCustomCtaToggle = document.getElementById('useCustomCta');
            var customCtaInput = document.getElementById('customCtaInput');
            if (confirmCtaBtn) confirmCtaBtn.addEventListener('click', completeThread);
            if (backToHookBtn) backToHookBtn.addEventListener('click', function() { setStep(2); });
            if (useCustomCtaToggle) useCustomCtaToggle.addEventListener('change', toggleCustomCta);
            if (customCtaInput) customCtaInput.addEventListener('input', updateCustomCtaCharCount);

            // Start over button
            var startOverBtn = document.getElementById('startOverBtn');
            if (startOverBtn) startOverBtn.addEventListener('click', resetToStart);
        }

        // Load formatting settings
        function loadFormattingSettings() {
            var numbering = localStorage.getItem('threadgen_numbering');
            var emoji = localStorage.getItem('threadgen_emoji');
            var tone = localStorage.getItem('threadgen_tone');

            state.settings.tweetNumbering = numbering !== 'false';
            state.settings.emojiUsage = emoji === 'true';
            state.settings.tone = tone || 'educational';

            var numberingToggle = document.getElementById('tweetNumbering');
            var emojiToggle = document.getElementById('emojiUsage');
            if (numberingToggle) numberingToggle.checked = state.settings.tweetNumbering;
            if (emojiToggle) emojiToggle.checked = state.settings.emojiUsage;

            // Set tone radio
            var toneRadio = document.querySelector('input[name="tone"][value="' + state.settings.tone + '"]');
            if (toneRadio) toneRadio.checked = true;
        }

        function toggleSettings() {
            elements.settingsPanel.classList.toggle('visible');
        }

        // Output fade-in animation
        function animateOutput() {
            elements.threadOutput.classList.remove('fade-in');
            void elements.threadOutput.offsetWidth; // Trigger reflow
            elements.threadOutput.classList.add('fade-in');
        }

        function toggleKeyVisibility() {
            elements.apiKeyInput.type = elements.apiKeyInput.type === 'password' ? 'text' : 'password';
        }

        function updateInputCount() {
            var length = elements.inputText.value.length;
            elements.inputCount.textContent = length.toLocaleString() + ' chars';
        }

        function updateOutputCount(tweetCount) {
            elements.outputCount.textContent = tweetCount + ' tweet' + (tweetCount !== 1 ? 's' : '');
        }

        function isLtgvKey(key) {
            return key && key.indexOf('ltgv_') === 0;
        }

        function loadApiKey() {
            var ltgvKey = localStorage.getItem('ltgv_api_key');

            if (ltgvKey) {
                elements.apiKeyInput.value = ltgvKey;
                // Check subscription status
                checkSubscriptionStatus(ltgvKey);
            }
            // Free trial users don't need to add an API key
        }

        // Check subscription status and hide Subscribe CTA if subscribed
        function checkSubscriptionStatus(apiKey) {
            console.log('=== SUBSCRIPTION CHECK DEBUG ===');
            fetch('/api/keys', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey
                }
            })
            .then(function(response) {
                // Handle invalid/revoked API keys
                if (response.status === 401) {
                    console.log('API key is invalid or revoked - removing from localStorage');
                    localStorage.removeItem('ltgv_api_key');
                    elements.apiKeyInput.value = '';
                    state.apiKeyValid = false;
                    updateFreeTrialUI(false);
                    return { success: false, invalid: true };
                }
                return response.json();
            })
            .then(function(data) {
                if (data.invalid) {
                    // Already handled above
                    return;
                }
                console.log('Subscription data:', data.subscriptions);
                if (data.success && data.subscriptions && data.subscriptions.threadgen) {
                    console.log('User is subscribed to ThreadGen - updating buttons');
                    state.apiKeyValid = true;
                    state.isSubscribed = true;
                    // Update usage counter to show unlimited
                    updateFreeTrialUI(true);
                    // Update all subscribe buttons to show subscribed state
                    var subscribeButtons = document.querySelectorAll('.btn-subscribe');
                    subscribeButtons.forEach(function(btn) {
                        btn.textContent = 'Subscribed ';
                        btn.classList.add('btn-subscribed');
                        btn.onclick = function(e) {
                            e.preventDefault();
                            alert('You\'re already subscribed to ThreadGen! Manage your subscription in the dashboard.');
                        };
                    });
                    // Update the bottom CTA text
                    var ctaText = document.querySelector('#bottomCta p');
                    if (ctaText) {
                        ctaText.textContent = 'You have unlimited access to ThreadGen.';
                    }
                } else if (data.success) {
                    // Key is valid but NOT subscribed to ThreadGen
                    console.log('User not subscribed to ThreadGen, but key is valid');
                    state.apiKeyValid = true;
                    state.isSubscribed = false;
                    updateFreeTrialUI(false);
                } else {
                    console.log('API key validation failed');
                    state.apiKeyValid = false;
                    state.isSubscribed = false;
                    updateFreeTrialUI(false);
                }
            })
            .catch(function(err) {
                console.log('Subscription check ERROR:', err);
                state.apiKeyValid = false;
                updateFreeTrialUI(false);
            });
        }

        function saveApiKey() {
            var apiKey = elements.apiKeyInput.value.trim();

            if (!apiKey) {
                showStatus('Please enter your API key. <a href="/dashboard.html">Get your key from the dashboard</a>', 'error');
                return;
            }

            if (isLtgvKey(apiKey)) {
                localStorage.setItem('ltgv_api_key', apiKey);
                showStatus('API key saved', 'success');
                // Check subscription status for newly saved key
                checkSubscriptionStatus(apiKey);
                updateFreeTrialUI();
            } else {
                showStatus('Invalid key format. Your key should start with ltgv_. <a href="/dashboard.html">Get a new key</a>', 'error');
                return;
            }

            setTimeout(function() {
                elements.settingsPanel.classList.remove('visible');
                hideStatus();
            }, 1500);
        }

        function showStatus(message, type) {
            type = type || 'info';
            elements.status.innerHTML = message;
            elements.status.className = 'status visible ' + type;
        }

        function hideStatus() {
            elements.status.classList.remove('visible');
        }

        // Step Navigation
        function setStep(stepNumber) {
            state.currentStep = stepNumber;

            // Update step indicator
            document.querySelectorAll('.step').forEach(function(step, index) {
                var stepNum = index + 1;
                step.classList.remove('active', 'completed');
                if (stepNum < stepNumber) {
                    step.classList.add('completed');
                } else if (stepNum === stepNumber) {
                    step.classList.add('active');
                }
            });

            // Hide all views
            elements.mainContent.classList.add('hidden');
            elements.hookSelectionView.classList.add('hidden');
            elements.bodyGenerationView.classList.add('hidden');
            elements.ctaSelectionView.classList.add('hidden');
            elements.results.classList.remove('visible');
            elements.tooShortWarning.classList.add('hidden');

            // Show appropriate view
            switch (stepNumber) {
                case 1:
                    elements.mainContent.classList.remove('hidden');
                    break;
                case 2:
                    elements.hookSelectionView.classList.remove('hidden');
                    break;
                case 3:
                    elements.bodyGenerationView.classList.remove('hidden');
                    break;
                case 4:
                    elements.ctaSelectionView.classList.remove('hidden');
                    break;
                case 5:
                    elements.mainContent.classList.remove('hidden');
                    elements.results.classList.add('visible');
                    elements.results.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    break;
            }
        }

        // Reset to start
        function resetToStart() {
            state = {
                currentStep: 1,
                originalContent: '',
                processedContent: '',
                selectedHook: null,
                selectedHookIndex: -1,
                hookOptions: [],
                bodyTweets: [],
                selectedCta: null,
                selectedCtaIndex: -1,
                ctaOptions: [],
                customCta: '',
                useCustomCta: false,
                finalThread: [],
                settings: state.settings
            };
            currentThread = [];
            elements.inputText.value = '';
            updateCharCount();
            hideStatus();
            setStep(1);
        }

        // Content Preprocessing
        function preprocessContent(rawContent) {
            var processed = rawContent;
            processed = processed.replace(/\b\d{1,2}:\d{2}(:\d{2})?\b/g, '');
            processed = processed.replace(/https?:\/\/[^\s]+/g, '');
            processed = processed.replace(/\b(um|uh|like|you know|basically|actually|literally|honestly|frankly)\b/gi, '');
            processed = processed.replace(/\b(kind of|sort of|i mean|i guess)\b/gi, '');
            processed = processed.replace(/^#{1,6}\s+/gm, '');
            processed = processed.replace(/\*{1,2}([^*]+)\*{1,2}/g, '$1');
            processed = processed.replace(/_{1,2}([^_]+)_{1,2}/g, '$1');
            processed = processed.replace(/`([^`]+)`/g, '$1');
            processed = processed.replace(/^\s*[-*+]\s+/gm, '');
            processed = processed.replace(/^\s*\d+\.\s+/gm, '');
            processed = processed.replace(/\n{3,}/g, '\n\n');
            processed = processed.replace(/[ \t]+/g, ' ');
            return processed.trim();
        }

        // Content length validation
        function checkContentLength(content) {
            var words = content.split(/\s+/).filter(function(w) { return w.length > 0; });
            var wordCount = words.length;
            var charCount = content.length;

            if (wordCount < 50 || charCount < 300) {
                return { valid: false, reason: 'too_short', wordCount: wordCount, charCount: charCount };
            }
            return { valid: true, wordCount: wordCount, charCount: charCount };
        }

        // Start Generation - generates complete thread at once
        async function startGeneration() {
            var text = elements.inputText.value.trim();

            if (!text) {
                showStatus('Paste your content, article, or idea to transform into a Twitter thread.', 'error');
                return;
            }

            if (text.length < 100) {
                showStatus('Content is too short (minimum 100 characters). Add more detail to generate a quality thread.', 'error');
                return;
            }

            state.originalContent = text;

            var ltgvKey = localStorage.getItem('ltgv_api_key');
            var freeUses = getFreeTrialUses();
            var usingFreeTrial = (!ltgvKey || !state.apiKeyValid || !state.isSubscribed) && freeUses > 0;

            // Block if not subscribed AND no free uses left
            if ((!ltgvKey || !state.apiKeyValid || !state.isSubscribed) && freeUses <= 0) {
                showStatus('Free trial ended. <a href="/pricing.html">Subscribe for unlimited access</a>', 'error');
                return;
            }

            elements.generateBtn.disabled = true;
            elements.generateBtn.classList.add('loading');
            elements.loading.classList.add('visible');
            if (elements.loadingText) {
                elements.loadingText.textContent = 'Creating your thread...';
            }
            elements.quickActions.classList.remove('visible');
            elements.alternativesSection.classList.remove('visible');
            elements.improvementTips.classList.remove('visible');
            elements.confidenceScore.classList.remove('visible');
            hideStatus();

            try {
                var headers = { 'Content-Type': 'application/json' };
                if (ltgvKey) {
                    headers['x-api-key'] = ltgvKey;
                } else {
                    headers['x-free-trial'] = 'true';
                }

                // Call API to generate complete thread
                var response = await fetch('/api/tools/threadgen', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        action: 'full_thread',
                        content: text,
                        tone: state.settings.tone,
                        tweetNumbering: state.settings.tweetNumbering,
                        emojiUsage: state.settings.emojiUsage
                    })
                });

                var data = await response.json();

                if (!response.ok) {
                    if (data.error === 'LIMIT_EXCEEDED') {
                        throw new Error('Free trial ended. <a href="/pricing.html">Subscribe for unlimited access</a>');
                    }
                    if (data.error && (data.error.includes('Invalid') || data.error.includes('revoked') || data.error.includes('expired'))) {
                        throw new Error('Your access has expired. <a href="/dashboard.html">Get a new access link</a>');
                    }
                    throw new Error('Something went wrong. Please try again.');
                }

                // Decrement free trial if applicable
                if (usingFreeTrial) {
                    decrementFreeTrial();
                    updateFreeTrialUI();
                }

                // Display the thread
                displayThread(data.result);
                markAsGenerated();
                showStatus('Thread generated! Click Copy Thread to use it.', 'success');

            } catch (error) {
                showStatus(error.message || 'Something went wrong. Please try again.', 'error');
            } finally {
                elements.loading.classList.remove('visible');
                elements.generateBtn.disabled = false;
                elements.generateBtn.classList.remove('loading');
            }
        }

        // Generate Hook Options (LTG Vault)
        async function generateHookOptionsLTGV(apiKey, content, usingFreeTrial) {
            var headers = { 'Content-Type': 'application/json' };
            if (apiKey) {
                headers['x-api-key'] = apiKey;
            } else {
                headers['x-free-trial'] = 'true';
            }

            var response = await fetch('/api/tools/threadgen', {
                method: 'POST',
                headers: headers,
                body: JSON.stringify({
                    action: 'hooks',
                    content: content,
                    emojiUsage: state.settings.emojiUsage,
                    tone: state.settings.tone
                })
            });

            var data = await response.json();

            if (!response.ok) {
                if (data.error === 'LIMIT_EXCEEDED') {
                    throw new Error(data.message + ' <a href="/pricing.html">pricing</a>');
                }
                throw new Error(data.error || 'API request failed.');
            }

            // Update usage info for authenticated users
            if (data.usage) {
                var usageInfo = document.getElementById('usageInfo');
                var limitText = data.usage.limit === 'unlimited' ? 'unlimited' : data.usage.limit;
                usageInfo.textContent = 'Usage this month: ' + data.usage.used + ' / ' + limitText;
                usageInfo.style.display = 'block';
            }

            return data.result;
        }

        // Parse JSON response
        function parseJsonResponse(content) {
            if (!content) throw new Error('No response. Please try again.');
            try {
                var jsonMatch = content.match(/\[[\s\S]*\]/);
                if (jsonMatch) return JSON.parse(jsonMatch[0]);
                throw new Error('Invalid format');
            } catch (e) {
                throw new Error('Something went wrong. Please try again.');
            }
        }

        // Display Hook Options
        function displayHookOptions(hooks) {
            elements.hookOptions.innerHTML = '';

            var typeLabels = {
                'curiosity': 'Curiosity / Open Loop',
                'bold_claim': 'Bold Claim / Hot Take',
                'story': 'Story-Driven'
            };

            hooks.forEach(function(hook, index) {
                var optionDiv = document.createElement('div');
                optionDiv.className = 'hook-option';
                optionDiv.dataset.index = index;

                optionDiv.innerHTML = '<div class="option-type">' + (typeLabels[hook.type] || hook.type) + '</div><div class="option-content">' + escapeHtml(hook.content) + '</div><div class="option-char-count">' + hook.content.length + '/280</div>';

                optionDiv.addEventListener('click', function() { selectHook(index); });
                elements.hookOptions.appendChild(optionDiv);
            });

            state.selectedHookIndex = -1;
            state.selectedHook = null;
            document.getElementById('confirmHookBtn').disabled = true;
        }

        // Select a hook
        function selectHook(index) {
            state.selectedHookIndex = index;
            state.selectedHook = state.hookOptions[index].content;

            document.querySelectorAll('.hook-option').forEach(function(opt, i) {
                opt.classList.toggle('selected', i === index);
            });

            document.getElementById('confirmHookBtn').disabled = false;
        }

        // Continue with hook (Step 2 -> Step 3 -> Step 4)
        async function continueWithHook() {
            if (state.selectedHookIndex === -1) {
                showStatus('Select a hook option above to continue building your thread.', 'error');
                return;
            }

            var ltgvKey = localStorage.getItem('ltgv_api_key');
            var freeUses = getFreeTrialUses();
            // Use free trial if: no key OR invalid key OR not subscribed to THIS tool
            var usingFreeTrial = (!ltgvKey || !state.apiKeyValid || !state.isSubscribed) && freeUses > 0;

            console.log('=== CONTINUE WITH HOOK ===');
            console.log('ltgvKey:', ltgvKey ? 'exists (' + ltgvKey.substring(0,10) + '...)' : 'null');
            console.log('state.apiKeyValid:', state.apiKeyValid);
            console.log('state.isSubscribed:', state.isSubscribed);
            console.log('freeUses:', freeUses);
            console.log('usingFreeTrial:', usingFreeTrial);

            // Block if not subscribed AND no free uses left
            if ((!ltgvKey || !state.apiKeyValid || !state.isSubscribed) && freeUses <= 0) {
                showStatus('Free trial ended. <a href="/pricing.html">Subscribe for unlimited access</a>', 'error');
                return;
            }

            setStep(3);

            try {
                var bodyData = await generateThreadBodyLTGV(ltgvKey, state.processedContent, state.selectedHook, usingFreeTrial);
                state.bodyTweets = bodyData.body;
                state.ctaOptions = bodyData.ctas;

                console.log('=== BODY GENERATION SUCCESS ===');
                console.log('usingFreeTrial:', usingFreeTrial);

                // Decrement free trial on successful body generation
                if (usingFreeTrial) {
                    console.log('Calling decrementFreeTrial...');
                    decrementFreeTrial();
                    updateFreeTrialUI();
                } else {
                    console.log('NOT decrementing - usingFreeTrial is false');
                }

                displayCtaOptions(state.ctaOptions);
                setStep(4);
            } catch (error) {
                console.log('Body generation FAILED:', error.message);
                showStatus(error.message || 'Something went wrong. Please try again.', 'error');
                setStep(2);
            }
        }

        // Generate Thread Body (LTG Vault)
        async function generateThreadBodyLTGV(apiKey, content, selectedHook, usingFreeTrial) {
            var headers = { 'Content-Type': 'application/json' };
            if (apiKey) {
                headers['x-api-key'] = apiKey;
            } else {
                headers['x-free-trial'] = 'true';
            }

            var response = await fetch('/api/tools/threadgen', {
                method: 'POST',
                headers: headers,
                body: JSON.stringify({
                    action: 'body',
                    content: content,
                    hook: selectedHook,
                    emojiUsage: state.settings.emojiUsage,
                    tone: state.settings.tone
                })
            });

            var data = await response.json();
            if (!response.ok) throw new Error(data.error || 'API request failed.');
            return data.result;
        }

        // Validate tweet length
        function validateTweetLength(tweet) {
            if (tweet.length > 280) return tweet.substring(0, 277) + '...';
            return tweet;
        }

        // Display CTA Options
        function displayCtaOptions(ctas) {
            elements.ctaOptions.innerHTML = '';

            var typeLabels = {
                'takeaway': 'Punchy Takeaway',
                'engagement': 'Specific Question',
                'cta': 'Call to Action',
                'follow': 'Natural Follow',
                'link': 'Link CTA',
                'clean_exit': 'Clean Exit'
            };

            ctas.forEach(function(cta, index) {
                var optionDiv = document.createElement('div');
                optionDiv.className = 'cta-option';
                optionDiv.dataset.index = index;

                optionDiv.innerHTML = '<div class="option-type">' + (typeLabels[cta.type] || cta.type) + '</div><div class="option-content">' + escapeHtml(cta.content) + '</div><div class="option-char-count">' + cta.content.length + '/280</div>';

                optionDiv.addEventListener('click', function() { selectCta(index); });
                elements.ctaOptions.appendChild(optionDiv);
            });

            state.selectedCtaIndex = -1;
            state.selectedCta = null;
            state.useCustomCta = false;
            state.customCta = '';

            document.getElementById('confirmCtaBtn').disabled = true;

            var customToggle = document.getElementById('useCustomCta');
            var customInput = document.getElementById('customCtaInput');
            var customCharCount = document.getElementById('customCtaCharCount');
            if (customToggle) customToggle.checked = false;
            if (customInput) { customInput.classList.add('hidden'); customInput.value = ''; }
            if (customCharCount) { customCharCount.classList.add('hidden'); customCharCount.textContent = '0/280'; }
        }

        // Select a CTA
        function selectCta(index) {
            if (state.useCustomCta) return;

            state.selectedCtaIndex = index;
            state.selectedCta = state.ctaOptions[index].content;

            document.querySelectorAll('.cta-option').forEach(function(opt, i) {
                opt.classList.toggle('selected', i === index);
            });

            document.getElementById('confirmCtaBtn').disabled = false;
        }

        // Toggle custom CTA mode
        function toggleCustomCta() {
            var toggle = document.getElementById('useCustomCta');
            var customInput = document.getElementById('customCtaInput');
            var customCharCount = document.getElementById('customCtaCharCount');
            var confirmBtn = document.getElementById('confirmCtaBtn');

            if (toggle && customInput && customCharCount) {
                state.useCustomCta = toggle.checked;

                if (toggle.checked) {
                    customInput.classList.remove('hidden');
                    customCharCount.classList.remove('hidden');
                    document.querySelectorAll('.cta-option').forEach(function(opt) { opt.classList.remove('selected'); });
                    state.selectedCtaIndex = -1;
                    state.selectedCta = null;
                    if (confirmBtn) confirmBtn.disabled = customInput.value.trim().length === 0;
                } else {
                    customInput.classList.add('hidden');
                    customCharCount.classList.add('hidden');
                    if (confirmBtn) confirmBtn.disabled = state.selectedCtaIndex === -1;
                }
            }
        }

        // Update custom CTA character count
        function updateCustomCtaCharCount() {
            var customInput = document.getElementById('customCtaInput');
            var customCharCount = document.getElementById('customCtaCharCount');
            var confirmBtn = document.getElementById('confirmCtaBtn');

            if (customInput && customCharCount) {
                var len = customInput.value.length;
                customCharCount.textContent = len + '/280';
                state.customCta = customInput.value;

                if (state.useCustomCta && confirmBtn) {
                    confirmBtn.disabled = len === 0 || len > 280;
                }
            }
        }

        // Complete thread (Step 4 -> Step 5)
        function completeThread() {
            var cta = state.useCustomCta ? state.customCta : state.selectedCta;

            if (!cta) {
                showStatus('Select or write a call-to-action to complete your thread.', 'error');
                return;
            }

            state.finalThread = [state.selectedHook].concat(state.bodyTweets).concat([cta]);

            currentThread = state.finalThread;
            displayThread(state.finalThread);
            showStatus('Thread generated successfully!', 'success');
            setStep(5);
        }

        // Legacy generateThread for backwards compatibility
        async function generateThread() {
            await startGeneration();
        }

        async function callOpenAI(apiKey, content) {
            var systemPrompt = 'You write Twitter threads. Your #1 job is to find the buried hook.\n\nFINDING THE HOOK (THIS IS EVERYTHING):\nFirst tweet is everything. Look for the most SPECIFIC and UNEXPECTED detail in the input.\n\nGeneric relatable moments are NOT hooks:\n- "i can\'t wake up early"  NOT a hook (too generic)\n- "so i\'ve been trying to..."  NOT a hook\n- "honestly it\'s not going great"  NOT a hook\n\nSpecific absurd details ARE hooks:\n- "my smoke alarm has gone off more from cooking attempts than any real emergency"  THIS is a hook (specific, funny, visual)\n- "i bought candles because someone said it helps with motivation. they\'re still in the bag from Target"  THIS is a hook\n- "mom asked for my disney plus password and i realized i hadn\'t opened it in 3 months but i\'m still paying for it"  THIS is a hook\n\nThe hook is specific, absurd, and relatable. No metaphors. Just what happened.\n\nHOOK PRIORITY  rank hook quality like this:\n1. Weird + specific: "i have a note that just says \'blue car Tuesday\' and i have no idea what that means"  makes you think "wait what?"\n2. Absurd + specific: "my smoke alarm has gone off more from cooking attempts than any real emergency"\n3. Relatable + specific: "$400 on doordash in a month"\n4. Just specific: "i have 47 tabs open"  fine but not as strong\n\nLead with tier 1 or 2 when available. Always pick the detail that makes someone think "wait what?" over the one that\'s just relatable.\n\nHOOK TEST:\nDoes it have a specific detail? Is it weird or absurd? Does it make you curious? Does it have NO metaphor?\nScan for: weird unexplained details, brand names, specific objects, absurd admissions, unexpected behaviors.\n\nYour job:\n1. Read the ENTIRE input first\n2. Find the most SPECIFIC and UNEXPECTED detail\n3. Lead with THAT as the first tweet\n4. Then tell the story around it\n\nRULES:\n1. Each tweet MUST be under 280 characters (count carefully)\n2. First tweet starts with the thread emoji\n3. Keep specific details (numbers, names, real examples)\n4. Aim for 5-12 tweets depending on content length\n\nCAPITALIZATION (MANDATORY):\nCapital "I" ONLY at the start of a tweet. Lowercase "i" everywhere else in the tweet. No exceptions.\n\nTRANSITIONS:\n- Never use "?" after a short phrase\n- Bad: "the worst part?"  Good: "the worst part is"\n- Bad: "my solution?"  Good: "my solution was"\n\nABSOLUTELY BANNED  NEVER USE THESE:\n- "Spoiler:", "Classic.", "Same.", "Mood."  BANNED\n- "The struggle is real", "adulting"  BANNED\n- "Why?" as standalone rhetorical question  BANNED\n- Single word reactions  BANNED\n- Any self-comparison to objects  BANNED\n- "let me break it down", "here\'s the thing", "plot twist:", "trust me"  BANNED\n\nNO METAPHORS, SIMILES, OR POETIC COMPARISONS  EVER.\nReal people don\'t use metaphors when venting. They just say what happened. Flat statements only.\n\nDO THIS:\n- Write like texting a friend\n- Keep specific details (numbers, names, real examples)\n- Incomplete thoughts are ok\n- Honesty > polish\n- Relatability > insight\n\nCONTENT RULES:\n- Never use swear words or profanity\n- Keep it clean for all audiences\n\nLAST TWEET GUIDELINES:\n- Simple and honest, not trying to be clever or quotable\n- One short line\n- Should NOT sound like a motivational poster\n\nOUTPUT FORMAT:\nReturn ONLY a JSON array of tweet strings. No numbering, no explanations.';

            var response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + apiKey
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [
                        { role: 'system', content: systemPrompt },
                        { role: 'user', content: 'Transform this content into a Twitter thread:\n\n' + content }
                    ],
                    temperature: 0.7,
                    max_tokens: 2000
                })
            });

            if (!response.ok) {
                var errorData = {};
                try { errorData = await response.json(); } catch(e) {}

                if (response.status === 401) {
                    throw new Error('Invalid API key. Please check your settings.');
                } else if (response.status === 429) {
                    throw new Error('Rate limit exceeded. Please wait a moment and try again.');
                } else if (response.status === 503) {
                    throw new Error('Service temporarily unavailable. Please try again in a moment.');
                } else {
                    throw new Error('Something went wrong. Please try again.');
                }
            }

            var data = await response.json();
            var contentResponse = data.choices[0]?.message?.content;

            if (!contentResponse) {
                throw new Error('No response from OpenAI. Please try again.');
            }

            // Parse the JSON response
            var tweets;
            try {
                var jsonMatch = contentResponse.match(/\[[\s\S]*\]/);
                if (jsonMatch) {
                    tweets = JSON.parse(jsonMatch[0]);
                } else {
                    throw new Error('Invalid format');
                }
            } catch (e) {
                throw new Error('Something went wrong. Please try again.');
            }

            if (!Array.isArray(tweets) || tweets.length === 0) {
                throw new Error('No tweets generated. Please try again.');
            }

            // Ensure all tweets are under 280 characters
            tweets = tweets.map(function(tweet) {
                if (tweet.length > 280) {
                    return tweet.substring(0, 277) + '...';
                }
                return tweet;
            });

            return tweets;
        }

        function displayThread(tweets) {
            elements.tweetsContainer.innerHTML = '';

            for (var index = 0; index < tweets.length; index++) {
                var tweet = tweets[index];
                var tweetCard = document.createElement('div');
                tweetCard.className = 'tweet-card';

                // Apply numbering if enabled
                var displayNumber = state.settings.tweetNumbering
                    ? (index + 1) + '/' + tweets.length
                    : 'Tweet ' + (index + 1);

                tweetCard.innerHTML = '<div class="tweet-header"><span class="tweet-number">' + displayNumber + '</span><span class="tweet-char-count">' + tweet.length + '/280</span></div><div class="tweet-content">' + escapeHtml(tweet) + '</div><div class="tweet-footer"><button class="copy-tweet-btn" data-index="' + index + '"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> Copy</button></div>';

                elements.tweetsContainer.appendChild(tweetCard);
            }

            // Add copy event listeners
            var copyBtns = document.querySelectorAll('.copy-tweet-btn');
            for (var i = 0; i < copyBtns.length; i++) {
                (function(btn) {
                    btn.addEventListener('click', function() {
                        var idx = parseInt(btn.getAttribute('data-index'));
                        copyTweet(idx, btn);
                    });
                })(copyBtns[i]);
            }

            elements.results.classList.add('visible');
        }

        function copyTweet(index, button) {
            var tweet = currentThread[index];

            navigator.clipboard.writeText(tweet).then(function() {
                button.classList.add('copied');
                button.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> Copied!';

                setTimeout(function() {
                    button.classList.remove('copied');
                    button.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> Copy';
                }, 2000);
            }).catch(function() {
                showStatus('Could not copy to clipboard. Try selecting and copying manually.', 'error');
            });
        }

        function copyAllTweets() {
            var parts = [];
            for (var i = 0; i < currentThread.length; i++) {
                if (state.settings.tweetNumbering) {
                    parts.push((i + 1) + '/' + currentThread.length + '\n' + currentThread[i]);
                } else {
                    parts.push(currentThread[i]);
                }
            }
            var fullThread = parts.join('\n\n');

            var originalHTML = elements.copyAllBtn.innerHTML;

            navigator.clipboard.writeText(fullThread).then(function() {
                elements.copyAllBtn.classList.add('copied');
                elements.copyAllBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> Copied!';

                setTimeout(function() {
                    elements.copyAllBtn.classList.remove('copied');
                    elements.copyAllBtn.innerHTML = originalHTML;
                }, 2000);
            }).catch(function() {
                showStatus('Could not copy to clipboard. Try selecting and copying manually.', 'error');
            });
        }

        // Copy thread (new UI)
        function copyThread() {
            if (!generatedThread) return;

            navigator.clipboard.writeText(generatedThread).then(function() {
                elements.copyBtn.classList.add('copied');
                elements.copyText.textContent = 'Copied!';

                setTimeout(function() {
                    elements.copyBtn.classList.remove('copied');
                    elements.copyText.textContent = 'Copy Thread';
                }, 2000);
            }).catch(function() {
                showStatus('Could not copy to clipboard. Try selecting and copying manually.', 'error');
            });
        }

        // Quick action handler
        async function handleQuickAction(action) {
            if (!generatedThread) {
                showStatus('Generate a thread first, then use quick actions to refine it.', 'error');
                return;
            }

            // Disable quick action buttons
            var quickBtns = document.querySelectorAll('.quick-action-btn');
            quickBtns.forEach(function(btn) { btn.disabled = true; });

            elements.loading.classList.add('visible');
            if (elements.loadingText) {
                elements.loadingText.textContent = 'Refining thread...';
            }

            try {
                var ltgvKey = localStorage.getItem('ltgv_api_key');
                var headers = { 'Content-Type': 'application/json' };
                if (ltgvKey) {
                    headers['x-api-key'] = ltgvKey;
                } else {
                    headers['x-free-trial'] = 'true';
                }

                var response = await fetch('/api/tools/threadgen', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        content: elements.inputText.value,
                        action: action,
                        currentThread: generatedThread,
                        tone: state.settings.tone,
                        tweetNumbering: state.settings.tweetNumbering,
                        emojiUsage: state.settings.emojiUsage
                    })
                });

                var data = await response.json();

                if (!response.ok) {
                    if (data.error && (data.error.includes('Invalid') || data.error.includes('revoked') || data.error.includes('expired'))) {
                        throw new Error('Your access has expired. <a href="/dashboard.html">Get a new access link</a>');
                    }
                    throw new Error('Something went wrong. Please try again.');
                }

                // Update output
                displayThread(data.result);
                showStatus('Thread refined!', 'success');

            } catch (error) {
                showStatus(error.message || 'Something went wrong. Please try again.', 'error');
            } finally {
                elements.loading.classList.remove('visible');
                quickBtns.forEach(function(btn) { btn.disabled = false; });
            }
        }

        // Display thread in output panel
        function displayThread(thread) {
            var tweets = Array.isArray(thread) ? thread : thread.split('\n\n').filter(function(t) { return t.trim(); });
            currentThread = tweets;
            generatedThread = tweets.join('\n\n');

            var html = '';
            for (var i = 0; i < tweets.length; i++) {
                html += '<div class="thread-tweet">';
                if (state.settings.tweetNumbering) {
                    html += '<span class="thread-tweet-number">' + (i + 1) + '/' + tweets.length + '</span>';
                }
                html += escapeHtml(tweets[i]).replace(/\n/g, '<br>');
                html += '</div>';
            }
            elements.threadOutput.innerHTML = html;
            animateOutput();
            updateOutputCount(tweets.length);
            elements.copyBtn.disabled = false;
            elements.quickActions.classList.add('visible');
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============ FEEDBACK FORM ============
        (function() {
            var feedbackForm = document.getElementById('feedbackForm');
            var feedbackText = document.getElementById('feedbackText');
            var feedbackSubmit = document.getElementById('feedbackSubmit');
            var feedbackSuccess = document.getElementById('feedbackSuccess');
            var feedbackError = document.getElementById('feedbackError');

            if (feedbackForm) {
                feedbackForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    var message = feedbackText.value.trim();
                    if (!message) return;

                    feedbackSubmit.disabled = true;
                    feedbackSubmit.textContent = 'Sending...';
                    feedbackSuccess.classList.remove('visible');
                    feedbackError.classList.remove('visible');

                    fetch('https://formspree.io/f/xdkogjkq', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            tool: 'ThreadGen',
                            message: message
                        })
                    })
                    .then(function(response) {
                        if (response.ok) {
                            feedbackSuccess.classList.add('visible');
                            feedbackText.value = '';
                            feedbackForm.style.display = 'none';
                        } else {
                            throw new Error('Failed');
                        }
                    })
                    .catch(function() {
                        feedbackError.classList.add('visible');
                    })
                    .finally(function() {
                        feedbackSubmit.disabled = false;
                        feedbackSubmit.textContent = 'Submit Feedback';
                    });
                });
            }
        })();

        // ============ TOOLTIP GUIDE ============
        (function() {
            var STORAGE_KEY = 'threadgen_tour_complete';

            // Skip if tour already completed
            if (localStorage.getItem(STORAGE_KEY)) return;

            var tooltips = [
                {
                    target: '#inputText',
                    text: 'Paste your content or idea to turn into a thread',
                    arrow: 'top'
                },
                {
                    target: '#toneSelect',
                    text: 'Choose your thread style',
                    arrow: 'top'
                },
                {
                    target: '#generateBtn',
                    text: 'Hit generate to create your thread!',
                    arrow: 'top'
                }
            ];

            var currentStep = 0;
            var overlay, tooltipBox;

            function createTooltipElements() {
                overlay = document.createElement('div');
                overlay.className = 'tooltip-overlay';
                document.body.appendChild(overlay);

                tooltipBox = document.createElement('div');
                tooltipBox.className = 'tooltip-box';
                tooltipBox.innerHTML = '<div class="tooltip-step"></div><div class="tooltip-text"></div><div class="tooltip-actions"><button class="tooltip-btn tooltip-btn-secondary" id="skipTour">Skip tour</button><button class="tooltip-btn tooltip-btn-primary" id="nextTip">Got it</button></div>';
                document.body.appendChild(tooltipBox);

                document.getElementById('skipTour').addEventListener('click', endTour);
                document.getElementById('nextTip').addEventListener('click', nextStep);
            }

            function showStep(index) {
                if (index >= tooltips.length) {
                    endTour();
                    return;
                }

                var tip = tooltips[index];
                var target = document.querySelector(tip.target);
                if (!target) {
                    nextStep();
                    return;
                }

                var prev = document.querySelector('.tooltip-highlight');
                if (prev) prev.classList.remove('tooltip-highlight');

                target.classList.add('tooltip-highlight');
                target.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(function() {
                    var rect = target.getBoundingClientRect();
                    tooltipBox.className = 'tooltip-box visible arrow-' + tip.arrow;

                    if (tip.arrow === 'top') {
                        tooltipBox.style.top = (rect.bottom + 16) + 'px';
                        tooltipBox.style.left = Math.max(20, rect.left) + 'px';
                    } else if (tip.arrow === 'bottom') {
                        tooltipBox.style.top = (rect.top - tooltipBox.offsetHeight - 16) + 'px';
                        tooltipBox.style.left = Math.max(20, rect.left) + 'px';
                    }

                    tooltipBox.querySelector('.tooltip-step').textContent = 'Step ' + (index + 1) + ' of ' + tooltips.length;
                    tooltipBox.querySelector('.tooltip-text').textContent = tip.text;

                    var nextBtn = document.getElementById('nextTip');
                    nextBtn.textContent = index === tooltips.length - 1 ? 'Start creating!' : 'Got it';
                }, 300);

                overlay.classList.add('visible');
            }

            function nextStep() {
                currentStep++;
                showStep(currentStep);
            }

            function endTour() {
                localStorage.setItem(STORAGE_KEY, 'true');
                overlay.classList.remove('visible');
                tooltipBox.classList.remove('visible');
                var highlighted = document.querySelector('.tooltip-highlight');
                if (highlighted) highlighted.classList.remove('tooltip-highlight');
            }

            setTimeout(function() {
                createTooltipElements();
                showStep(0);
            }, 800);
        })();

    </script>
</body>
</html>
